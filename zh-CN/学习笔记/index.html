<!DOCTYPE html>
<html lang="zh-CN,en,zh-TW,default">
    <head hexo-theme="https://github.com/volantis-x/hexo-theme-volantis/tree/4.2.0">
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
  
  <!-- 渲染优化 -->
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
  <title>tensorflow学习笔记 - 阿月浑子-Hexo博客</title>
  
    <meta name="keywords" content="学习笔记">
  

  

  <!-- feed -->
  
    <link rel="alternate" href="/atom.xml" title="阿月浑子-Hexo博客" type="application/atom+xml">
  

  <!-- import meta -->
  

  <!-- link -->
  

  <!-- import link -->
  

  
    
<link rel="stylesheet" href="/css/first.css">

  

  
  <link rel="stylesheet" href="/css/style.css" media="print" onload="this.media='all';this.onload=null">
  <noscript><link rel="stylesheet" href="/css/style.css"></noscript>
  

  <script id="loadcss"></script>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://unpkg.com/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://unpkg.com/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end -->
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>  <script>
    function music_on() {
        var audio1 = document.getElementById('bg_music');
        if (audio1.paused) {
            audio1.play();
        }else{
            audio1.pause();
            audio1.currentTime = 0;//音乐从头播放
        }
    }
    function BackTOP() {
        $("#btn").hide();
        $(function () {
            $(window).scroll(function () {
                if ($(window).scrollTop() > 50) {
                    $("#btn").fadeIn(200);
                } else {
                    $("#btn").fadeOut(200);
                }
            });
            $("#btn").click(function () {
                $('body,html').animate({
                        scrollTop: 0
                    },
                    500);
                return false;
            });
        });
        $(function () {
            $("#say").click(function () {
                $('body,html').animate({
                        scrollTop: $('html, body').get(0).scrollHeight
                    },
                    500);
                return false;
            });
        })
    }
 
    $('#readmode').click(function () {
            $('body').toggleClass('read-mode')
        })
        
    function SiderMenu() {
        $('#main-container').toggleClass('open');
        $('.iconflat').css('width', '50px').css('height', '50px');
        $('.openNav').css('height', '50px');
        $('#main-container,#mo-nav,.openNav').toggleClass('open')
    }
 
    function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($("body")), setTimeout(
            function () {
                var DarkMode = document.cookie.replace(/(?:(?:^|.*;\s*)DarkMode\s*\=\s*([^;]*).*$)|^.*$/, "$1") ||
                    '0';
                (volantis.dark.mode == "dark") 
                ? 
                ($("html").addClass("DarkMode"), 
                document.cookie = "DarkMode=1;path=/", 
                $('#modeicon').attr("xlink:href", "#icon-sun")) 
                : 
                ($("html").removeClass("DarkMode"), 
                document.cookie = "DarkMode=0;path=/", 
                $('#modeicon').attr("xlink:href", "#icon-_moon")), 
                setTimeout(function () {
                    $(".Cuteen_DarkSky").fadeOut(1e3, function () {
                        $(this).remove()
                    })
                }, 2e3)
            }), 50
    }
 
    function checkNightMode() {
        if ($("html").hasClass("n-f")) {
            $("html").removeClass("day");
            $("html").addClass("DarkMode");
            $('#modeicon').attr("xlink:href", "#icon-sun")
            return;
        }
        if ($("html").hasClass("d-f")) {
            $("html").removeClass("DarkMode");
            $("html").addClass("day");
            $('#modeicon').attr("xlink:href", "#icon-_moon")
 
            return;
        }
        if (document.cookie.replace(/(?:(?:^|.*;\s*)DarkMode\s*\=\s*([^;]*).*$)|^.*$/, "$1") === '') {
            if (volantis.dark.mode == "dark") {
                $("html").addClass("DarkMode");
                document.cookie = "DarkMode=1;path=/";
                console.log('夜间模式开启');
                $('#modeicon').attr("xlink:href", "#icon-sun")
            } else {
                $("html").removeClass("DarkMode");
                document.cookie = "DarkMode=0;path=/";
                console.log('夜间模式关闭');
                $('#modeicon').attr("xlink:href", "#icon-_moon")
            }
        } else {
            var DarkMode = document.cookie.replace(/(?:(?:^|.*;\s*)DarkMode\s*\=\s*([^;]*).*$)|^.*$/, "$1") || '0';
            if (DarkMode == '0') {
                $("html").removeClass("DarkMode");
                $('#modeicon').attr("xlink:href", "#icon-_moon")
            } else if (DarkMode == '1') {
                $("html").addClass("DarkMode");
                $('#modeicon').attr("xlink:href", "#icon-sun")
            }
        }
    }
    BackTOP();
</script>
 
<style>
    #RightDownBtn {
        position: fixed;
        left: 1.875rem;
        bottom: 1.875rem;
        padding: 0.3125rem 0.625rem;
        background: #fff;
        border-radius: 0.1875rem;
        transition: 0.3s ease all;
        z-index: 1;
        align-items: flex-end;
        flex-direction: column;
        display: -moz-flex;
        display: flex;
        float: right;
    }
 
    #RightDownBtn>a,
    #RightDownBtn>label {
        width: 1.5em;
        height: 1.5em;
        margin: 0.3125rem 0;
        transition: .2s cubic-bezier(.25, .46, .45, .94);
    }
 
    /* font color */
    .DarkMode #page,
    .DarkMode #colophon,
    .DarkMode #vcomments .vbtn,
    .DarkMode .art-content #archives .al_mon_list .al_mon,
    .DarkMode .art-content #archives .al_mon_list span,
    .DarkMode body,
    .DarkMode .art-content #archives .al_mon_list .al_mon,
    .DarkMode .art-content #archives .al_mon_list span,
    .DarkMode button,
    .DarkMode .art .art-content #archives a,
    .DarkMode textarea,
    .DarkMode strong,
    .DarkMode a,
    .DarkMode p,
	.DarkMode li,
    .DarkMode .label {
        color: rgba(255, 255, 255, .6);
    }
 
	
    .DarkMode #page,
    .DarkMode body,
    .DarkMode #colophon,
    .DarkMode #main-container,
    .DarkMode #page .yya,
    .DarkMode #content,
    .DarkMode #contentss,
    .DarkMode #footer {
        background-color: #292a2d;
    }
    .DarkMode strong,
    .DarkMode img {
        filter: brightness(.7);
    }
 
    /* sun and noon */
    .Cuteen_DarkSky,
    .Cuteen_DarkSky:before {
        content: "";
        position: fixed;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        z-index: 88888888
    }
 
    .Cuteen_DarkSky {
        background: linear-gradient(#feb8b0, #fef9db)
    }
 
    .Cuteen_DarkSky:before {
        transition: 2s ease all;
        opacity: 0;
        background: linear-gradient(#4c3f6d, #6c62bb, #93b1ed)
    }
 
    .DarkMode .Cuteen_DarkSky:before {
        opacity: 1
    }
 
    .Cuteen_DarkPlanet {
        z-index: 99999999;
        position: fixed;
        left: -50%;
        top: -50%;
        width: 200%;
        height: 200%;
        -webkit-animation: CuteenPlanetMove 2s cubic-bezier(.7, 0, 0, 1);
        animation: CuteenPlanetMove 2s cubic-bezier(.7, 0, 0, 1);
        transform-origin: center bottom
    }
 
    @-webkit-keyframes CuteenPlanetMove {
        0% {
            transform: rotate(0)
        }
 
        to {
            transform: rotate(360deg)
        }
    }
 
    @keyframes CuteenPlanetMove {
        0% {
            transform: rotate(0)
        }
 
        to {
            transform: rotate(360deg)
        }
    }
 
    .Cuteen_DarkPlanet:after {
        position: absolute;
        left: 35%;
        top: 40%;
        width: 9.375rem;
        height: 9.375rem;
        border-radius: 50%;
        content: "";
        background: linear-gradient(#fefefe, #fffbe8)
    }
</style>
  <body itemscope itemtype="http://schema.org/WebPage">
    <!-- import body_begin begin-->
        <script></script>
    <!-- import body_begin end-->
    <!-- Custom Files bodyBegin begin-->
    
    <!-- 浏览器搞笑标题-->
    <script type="text/javascript" src="/js/FunnyTitle.js"></script>
    <!-- Custom Files bodyBegin end-->
    <!--樱花特效-->
    <script src="https://gcore.jsdelivr.net/gh/zyoushuo/Blog/hexo/js/sakura.js"></script>
    <!--鼠标滑动特效-->
    <script src="https://gcore.jsdelivr.net/gh/zyoushuo/Blog/hexo/js/mouse_slide.js"></script>
    <!--鼠标点击特效-->
    <script src="https://gcore.jsdelivr.net/gh/zyoushuo/Blog/hexo/js/mouse_click.js"></script>
    <!--动态线条背景-->
    <!--<script type="text/javascript" color="220, 220, 220" opacity="0.6" zIndex="-2" count="100" src="/cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script> -->
    <script src="https://unpkg.com/hls.js@latest"></script>
<header itemscope itemtype="http://schema.org/WPHeader" id="l_header" class="l_header auto shadow show" style="opacity: 0">
  <div class="container">
  <div id="wrapper">
    <div class="nav-sub">
      <p class="title"></p>
      <ul class="switcher nav-list-h m-phone" id="pjax-header-nav-list">
        <li><a id="s-comment" class="fa-solid fa-comments fa-fw" target="_self" href="/" onclick="return false;" title="comment"></a></li>
        
          <li><a id="s-toc" class="s-toc fa-solid fa-list fa-fw" target="_self" href="/" onclick="return false;" title="toc"></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href="/">
          
            <img no-lazy class="logo" src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/Logo-NavBar@3x.png">
          
          
          
        </a>
      

			<div class="menu navigation">
				<ul class="nav-list-h m-pc">
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/" title="博客" active-action="action-home">
                  <i class="fa-solid fa-rss fa-fw"></i>博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/categories/" title="分类" active-action="action-categories">
                  <i class="fa-solid fa-folder-open fa-fw"></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/archives/" title="归档" active-action="action-archives">
                  <i class="fa-solid fa-archive fa-fw"></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/friends/" title="友链" active-action="action-friends">
                  <i class="fa-solid fa-link fa-fw"></i>友链
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/tags/" title="留言箱" active-action="action-tags">
                  <i class="fa-solid fa-tags fa-fw"></i>留言箱
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/about/" title="关于" active-action="action-about">
                  <i class="fa-solid fa-info-circle fa-fw"></i>关于
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/" onclick="return false;" title="更多">
                  <i class="fa-solid fa-ellipsis-v fa-fw"></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis/" title="主题源码" active-action="action-https:githubcomvolantis-xhexo-theme-volantis">
                  主题源码
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis/releases/" title="更新日志" active-action="action-https:githubcomvolantis-xhexo-theme-volantisreleases">
                  更新日志
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/" onclick="return false;" title="有疑问？">
                  有疑问？
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/faqs/" title="看 FAQ" active-action="action-faqs">
                  看 FAQ
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/volantis-docs/" title="看 本站源码" active-action="action-https:githubcomvolantis-xvolantis-docs">
                  看 本站源码
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis/issues/" title="提 Issue" active-action="action-https:githubcomvolantis-xhexo-theme-volantisissues">
                  提 Issue
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/" onclick="return false;" title="文学黑洞">
                  文学黑洞
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://meiriyiwen.com/random" title="每日一文" active-action="action-https:meiriyiwencomrandom">
                  每日一文
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.marxists.org/chinese/index.html" title="马克思主义文库" active-action="action-https:wwwmarxistsorgchineseindexhtml">
                  马克思主义文库
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.yikm.net/" title="游戏厅" active-action="action-https:wwwyikmnet">
                  游戏厅
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.xiaozhongjishu.com/" title="小众技术工具库" active-action="action-https:wwwxiaozhongjishucom">
                  小众技术工具库
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
          
				</ul>
			</div>
      
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fa-solid fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search...">
        </form>
      </div>
      

			<ul class="switcher nav-list-h m-phone">
				
					<li><a class="s-search fa-solid fa-search fa-fw" target="_self" href="/" onclick="return false;" title="search"></a></li>
				
				<li>
          <a class="s-menu fa-solid fa-bars fa-fw" target="_self" href="/" onclick="return false;" title="menu"></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/" title="博客" active-action="action-home">
                  <i class="fa-solid fa-rss fa-fw"></i>博客
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/categories/" title="分类" active-action="action-categories">
                  <i class="fa-solid fa-folder-open fa-fw"></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/archives/" title="归档" active-action="action-archives">
                  <i class="fa-solid fa-archive fa-fw"></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/friends/" title="友链" active-action="action-friends">
                  <i class="fa-solid fa-link fa-fw"></i>友链
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/tags/" title="留言箱" active-action="action-tags">
                  <i class="fa-solid fa-tags fa-fw"></i>留言箱
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/about/" title="关于" active-action="action-about">
                  <i class="fa-solid fa-info-circle fa-fw"></i>关于
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/" onclick="return false;" title="更多">
                  <i class="fa-solid fa-ellipsis-v fa-fw"></i>更多
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis/" title="主题源码" active-action="action-https:githubcomvolantis-xhexo-theme-volantis">
                  主题源码
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis/releases/" title="更新日志" active-action="action-https:githubcomvolantis-xhexo-theme-volantisreleases">
                  更新日志
                </a>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/" onclick="return false;" title="有疑问？">
                  有疑问？
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/faqs/" title="看 FAQ" active-action="action-faqs">
                  看 FAQ
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/volantis-docs/" title="看 本站源码" active-action="action-https:githubcomvolantis-xvolantis-docs">
                  看 本站源码
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis/issues/" title="提 Issue" active-action="action-https:githubcomvolantis-xhexo-theme-volantisissues">
                  提 Issue
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
                    
                      
            
              <hr>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href="/" onclick="return false;" title="文学黑洞">
                  文学黑洞
                </a>
                
                  <ul class="list-v">
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://meiriyiwen.com/random" title="每日一文" active-action="action-https:meiriyiwencomrandom">
                  每日一文
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.marxists.org/chinese/index.html" title="马克思主义文库" active-action="action-https:wwwmarxistsorgchineseindexhtml">
                  马克思主义文库
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.yikm.net/" title="游戏厅" active-action="action-https:wwwyikmnet">
                  游戏厅
                </a>
                
              </li>
            
          
                    
                      
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" target="_blank" rel="external nofollow noopener noreferrer" href="https://www.xiaozhongjishu.com/" title="小众技术工具库" active-action="action-https:wwwxiaozhongjishucom">
                  小众技术工具库
                </a>
                
              </li>
            
          
                    
                  </ul>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>

      <!-- Custom Files header begin -->
      
      <!-- Custom Files header end -->
		</div>
	</div>
  </div>
</header>

     <!-- 春节灯笼 -->
        <div class="deng-box2">
          <div class="deng">
            <div class="xian">

            </div>
            <div class="deng-a">
              <div class="deng-b">
                <div class="deng-t">年</div>
              </div>
            </div>
            <div class="shui shui-a">
              <div class="shui-c">

              </div>
              <div class="shui-b"></div>
            </div>
          </div>
        </div>
        <div class="deng-box3">
          <div class="deng">
            <div class="xian">

            </div>
            <div class="deng-a">
              <div class="deng-b">
                <div class="deng-t">新</div>
              </div>
            </div>
            <div class="shui shui-a">
              <div class="shui-c"></div>
              <div class="shui-b">

              </div>
            </div>
          </div>
        </div>
        <div class="deng-box1">
          <div class="deng">
            <div class="xian">

            </div>
            <div class="deng-a">
              <div class="deng-b">
                <div class="deng-t">乐</div>
              </div>
            </div>
            <div class="shui shui-a">
              <div class="shui-c"></div>
              <div class="shui-b"></div>
            </div>
          </div>
        </div>
        <div class="deng-box">
          <div class="deng">
            <div class="xian">

            </div>
            <div class="deng-a">
              <div class="deng-b">
                <div class="deng-t">快</div>
              </div>
            </div>
            <div class="shui shui-a">
              <div class="shui-c">

              </div>
              <div class="shui-b"></div>
            </div>
          </div>
        </div>
        <!-- 春节灯笼 -->
    <div id="l_body">
    <canvas id="fireworks" style="position:fixed; height: 100%; width: 100%;"></canvas>
      <div id="l_cover">
  
    
      <!-- see: /layout/_partial/scripts/_ctrl/coverCtrl.ejs -->
      <div id="none" class="cover-wrapper post dock" style="display: none;">
        
  <div id="parallax-window"></div>

<div class="cover-body">
  <div class="top">
    
    
      <p class="title">相思似海深旧事如天远</p>
    
    
      <p class="subtitle">where there is a will there is a way</p>
    
  </div>
  <div class="bottom">
    <div class="menu navigation">
      <div class="list-h">
        
          
            <a href="/v5/getting-started/" active-action="action-v5getting-started">
              <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/twemoji/assets/svg/1f5c3.svg" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/twemoji/assets/svg/1f5c3.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>文档</p>
            </a>
          
            <a href="/faqs/" active-action="action-faqs">
              <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/twemoji/assets/svg/1f516.svg" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/twemoji/assets/svg/1f516.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>帮助</p>
            </a>
          
            <a href="/examples/" active-action="action-examples">
              <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/twemoji/assets/svg/1f396.svg" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/twemoji/assets/svg/1f396.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>示例</p>
            </a>
          
            <a href="/contributors/" active-action="action-contributors">
              <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/twemoji/assets/svg/1f389.svg" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/twemoji/assets/svg/1f389.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>社区</p>
            </a>
          
            <a href="/archives/" active-action="action-archives">
              <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/twemoji/assets/svg/1f4f0.svg" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/twemoji/assets/svg/1f4f0.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>博客</p>
            </a>
          
            <a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis/" active-action="action-https:githubcomvolantis-xhexo-theme-volantis">
              <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/twemoji/assets/svg/1f9ec.svg" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/twemoji/assets/svg/1f9ec.svg" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="><p>源码</p>
            </a>
          
        
      </div>
    </div>
  </div>
</div>

        <div id="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
      </div>
    
  
</div>

    <!--Follow me on CSDN-->
    <a target="_blank" rel="external nofollow noopener noreferrer" href="https://blog.csdn.net/qq_38452951"> <img loading="lazy" width="149" height="149" style="position: absolute; top: 0; right: 0; border: 0;" src="https://img-blog.csdnimg.cn/1f8e1ef9be9f4f7db01fe3a2d57829de.png" class="lazyload" data-srcset="https://img-blog.csdnimg.cn/1f8e1ef9be9f4f7db01fe3a2d57829de.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" class="attachment-full size-full lazyload" alt="Fork me on GitHub" data-recalc-dims="1"></a>
      <div id="safearea">
        <div class="body-wrapper">
          
<div id="l_main" class>
  <article itemscope itemtype="http://schema.org/Article" class="article post white-box reveal md shadow article-type-post" id="post" itemprop="blogPost">
  <link itemprop="mainEntityOfPage" href="http://pistachio0812.github.io/zh-CN/学习笔记/">
  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="阿月浑子-Hexo博客">
  </span>
  <span hidden itemprop="post" itemscope itemtype="http://schema.org/Post">
    <meta itemprop="name" content="阿月浑子-Hexo博客">
    <meta itemprop="description" content="计算机视觉,文学,pytorch,hexo,江西理工大学,目标检测">
  </span>
  


  
    <span hidden>
      <meta itemprop="image" content="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png">
    </span>
  
  <div class="article-meta" id="top">
    
    
    
      <h1 class="title" itemprop="name headline">
        tensorflow学习笔记
      </h1>
      <div class="new-meta-box">
        
          
            
<div class="new-meta-item author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <a itemprop="url" class="author" target="_blank" href="https://blog.csdn.net/qq_38452951" rel="external nofollow noopener noreferrer">
    <img itemprop="image" src="https://img0.baidu.com/it/u=178892670,2966992691&fm=253&fmt=auto&app=138&f=JPEG?w=400&h=400" class="lazyload" data-srcset="https://img0.baidu.com/it/u=178892670,2966992691&fm=253&fmt=auto&app=138&f=JPEG?w=400&h=400" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
    <p itemprop="name">阿月浑子</p>
  </a>
</div>

          
        
          
            
  <div class="new-meta-item category">
    <i class="fa-solid fa-folder-open fa-fw" aria-hidden="true"></i>
    <a class="category-link" href="/categories/tensorflow/">tensorflow</a>
    
      <span hidden itemprop="about" itemscope itemtype="http://schema.org/Thing">
        <a href="/categories/tensorflow/" itemprop="url"><span itemprop="name">tensorflow</span></a>
      </span>
    
  </div>


          
        
          
            <div class="new-meta-item date" itemprop="dateCreated datePublished" datetime="2022-04-16T15:26:49+08:00">
  <a class="notlink">
    <i class="fa-solid fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2022年4月16日</p>
  </a>
</div>

          
        
          
            
  <div class="new-meta-item wordcount">
    <a class="notlink">
      <i class="fa-solid fa-keyboard fa-fw" aria-hidden="true"></i>
      <p>字数：10.5k 字</p>
    </a>
  </div>
  <div class="new-meta-item readtime">
    <a class="notlink">
      <i class="fa-solid fa-hourglass-half fa-fw" aria-hidden="true"></i>
      <p>时长：48 分钟</p>
    </a>
  </div>


          
        
        <!-- Custom Files topMeta begin-->
        
        <!-- Custom Files topMeta end-->
      </div>
    
  </div>


  <div id="layoutHelper-page-plugins"></div>
  <div id="post-body" itemprop="articleBody">
    <p>tf中矩阵量存在形式常用有三种，具体如下：<br>1.tf.Variable()<br>表示神经网络中可变化的量（可以通过trainable=False设置成不可变),可在运行中赋值，可以通过constant或者其他方式进行初始化。<br>2.tf.constant()<br>可以通过numpy中的array或者list,还有给定的shape和数值进行赋值<br>3.tf.placeholder()<br>相当于占位符，也是有shape的量，因为训练过程中需要不断赋值和替换值，而整体计算的结构是不变的。<br>代码：<br>//导包</p>
<p><code>import tensorflow as tf</code>    </p>
<p>//定义变量<br><code>A = tf.Variable(tf.ones([4,4]))</code></p>
<p>//变量初始化<br><code>import numpy as np      
cst = tf.constant(np.ones([4,4]),dtype=tf.float32)</code></p>
<h1 id="需要指定类型dtype-tf-float32-tf中不能隐式转换浮点和整型"><a href="#需要指定类型dtype-tf-float32-tf中不能隐式转换浮点和整型" class="headerlink" title="需要指定类型dtype=tf.float32,tf中不能隐式转换浮点和整型"></a>需要指定类型dtype=tf.float32,tf中不能隐式转换浮点和整型</h1><h1 id="cst-tf-constant-1-0-shape-4-4-dtype-tf-float32-也是可以的"><a href="#cst-tf-constant-1-0-shape-4-4-dtype-tf-float32-也是可以的" class="headerlink" title="cst = tf.constant(1.0,shape=[4,4],dtype=tf.float32)也是可以的"></a>cst = tf.constant(1.0,shape=[4,4],dtype=tf.float32)也是可以的</h1><p><code>A = tf.Variable(cst)</code></p>
<p>//定义placeholder<br><code>X = tf.placeholder(dtype=tf.float32,shape=[4,1])</code></p>
<p>//矩阵相乘<br><code>C = tf.matmul(A,X)</code></p>
<p>//定义Session<br><code>sess = tf.Session()</code></p>
<p>//初始化变量<br><code>init = tf.global_variables_initializer()</code></p>
<p>//执行初始化<br><code>sess.run(init)</code></p>
<p>//运行矩阵相乘<br><code>sess.run(C,feed_dict={X:[[1],[1],[1],[1]]})</code></p>
<p>//获取变量值<br><code>A_val = A.value()  
Avalue = sess.run(A_val)</code></p>
<p>//完整矩形相乘代码<br><code>import tensorflow as tf  
import numpy as np</code></p>
<p><code>X = tf.placeholder(dtype=tf.float32,shape=[4,1])  
A = tf.Variable(tf.zeros([4,4]))  
C = tf.matmul(A,X)  
sess = tf.session()  
init = tf.global_variables_initializer()  
sess.run(init)  
print(sess.run(A))</code></p>
<p>//为了使计算图更加清晰，可以使用variable_scope()<br>//定义变量名称<br><code>with  tf.variable_scope("first-nn-layer"):
    W = tf.Variable(tf.zeros([784,10]),name="W")
    b = tf.Variable(tf.zeros([10]),name="b")
    y = tf.matmul(x,W)+b
    variable_summaries(W)</code></p>
<p>//标识不同的变量<br>//不同作用域下的同名变量<br><code>with tf.variable_scope("first-nn-layer"):
    W = tf.Variable(tf.zeros([784,10]),name="W")
    b = tf.Variable(tf.zeros([10]),name="b")
    W1 = tf.Variable(tf.zeros([784,10]),name="W")
print(W.name)
print(W1.name)</code></p>
<h1 id="w、w1虽然name一样，但是计算中依然当成不同的变量，让同一个scope的同一变量可以通过get-variable-函数"><a href="#w、w1虽然name一样，但是计算中依然当成不同的变量，让同一个scope的同一变量可以通过get-variable-函数" class="headerlink" title="w、w1虽然name一样，但是计算中依然当成不同的变量，让同一个scope的同一变量可以通过get_variable()函数"></a>w、w1虽然name一样，但是计算中依然当成不同的变量，让同一个scope的同一变量可以通过get_variable()函数</h1><p>//获取变量<br><code>with tf.variable_scope("first-nn-layer") as scope:
    W = tf.get_variable("W",[784, 10])
    b = tf.get_variable("b",[10])
    scope.reuse_variables()#缺少则会报错
    W1 = tf.get_variables("W",shape=[784,10])
print(W.name)
print(W1.name)</code></p>
<h1 id="w、w1属于同一个变量"><a href="#w、w1属于同一个变量" class="headerlink" title="w、w1属于同一个变量"></a>w、w1属于同一个变量</h1><p>注：若此时缺少了scope.reuse_variables()则会报错，因为同时引用了同一个变量，对于不同层的变量，可以利用variable_scope进行区分，在再次引入相关变量时，需要加上reuse=True,否则依然会报错。如果变量不存在时加上reuse=True,依然会报错，因为该变量不存在</p>
<p><code>with tf.variable_scope("first-nn-layer") as scope:
    W = tf.get_variable("W",[784, 10])
    b = tf.get_variable("b",[10])
with tf.variable_scope("second-nn-layer") as scope:
    W = tf.get_variable("W",[784, 10])
    b = tf.get_variable("b",[10])
with tf.variable_scope("second-nn-layer", reuse=True) as scope:
    W3 = tf.get_variable("W",[784, 10])
    b3 = tf.get_variable("b",[10])
print(W.name)
print(W3.name)</code></p>
<p>//保存模型<br>//定义saver<br><code>saver = tf.train.Saver()</code></p>
<p>//在训练过程中进行保存，保存为训练过程中的变量<br>//变量保存<br><code>for itr in range(1000):
    ...
    saver.save(sess,"model/al",global_step=itr)</code></p>
<p>//加载计算<br>//变量载入<br><code>saver.restore(sess,"model/v2-200")</code></p>
<p>3.4构建计算图<br>//前面在描述计算图，这里观察所建立的计算图<br>//定义summary<br><code>train_writer = tf.summary.FileWriter("logdir",sess.graph)</code></p>
<p>注：sess.graph就是描绘的计算图，”logdir”是log的存储文件夹。在Shell中运行Tensorboard,在浏览器中输入localhost:6006,然后点击graph就可以看到设计的网络模型了。</p>
<p>//问题：描绘的计算图非常杂乱无章，变量命名的可读性很差，需要进行整理。<br>//变量命名<br><code>x = tf.placeholder(tf.float32,[None,784],name="input_x")
label = tf.placeholder(tf.float32,[None,10],name="input_label")
W = tf.Variable(tf.zeros([874,10]),name="W")
b = tf.Variable(tf.zeros([10]),name="b")</code></p>
<p>//问题：依然不够清楚，可以将输入层的x和label归为一类<br>//定义作用域<br><code>with tf.variable_scope("input"):
    x = tf.placeholder(tf.float32,[None,784],name="input_x")
    label = tf.placeholder(tf.float32,[None,10],name="input_label")
with tf.variable_scope("first-nn-layer"):
    W = tf.Variable(tf.zeros([784,10]), name="W")
    b = tf.Variable(tf.zeros([10]),name="b")
    y = tf.matmul(x,W)+b
with tf.variable_scope("loss"):
    loss = tf.reduce_mean(tf.square(y-label))</code></p>
<p>//同一作用域下的同名变量是相同的，涉及到变量复用的问题，以及后续变量的获取，为了观察变量的变化，需要观察的变量加入summary函数<br>//定义summary函数<br><code>def variable_summaries(var):
    with tf.name_scope('summaries'):
        mean = tf.reduce_mean(var)
        tf.summary.scalar('mean',mean)
        with tf.name_scope('stddev'):
            stddev = tf.sqrt(tf.reduce_mean(tf.square(var-mean)))
        tf.summary.scalar('stddev',stddev)
        tf.summary.scalar('max',tf.reduce_max(var))
        tf.summary.scalar('min',tf.reduce_min(var))
        tf.summary.histogram('histogram',var)</code></p>
<p>//若要观测W的相关情况，调用summary函数<br>//调用summary函数<br><code>variable_summaries(W)</code></p>
<p>//再用merge_all函数收集summary信息<br>//获取summary信息<br><code>merged = tf.summary.merge_all()</code></p>
<p>//summary保存<br><code>summary = sess.run(merged, feed_dict={x:batch_xs,label:batch_ys})
train_writer.add_summary(summary,itr)</code></p>
<p>注：此时可以在网页中访问，观察变量随迭代变化的情况，可以通过不同的方式对变量进行观测，比如时序统计、histogram,这些统计信息对于分析训练过程是非常重要的</p>
<p>3.5全连接网络构建<br>//tf官方手写识别版本的简化版本<br>//单层全连接网络</p>
<h1 id="引入库"><a href="#引入库" class="headerlink" title="引入库"></a>引入库</h1><p><code>from tensorflow.examples.tutorials.mnist import input_data#产生数据，手写识别的图片和标签
import tensorflow as tf</code></p>
<h1 id="获取数据"><a href="#获取数据" class="headerlink" title="获取数据"></a>获取数据</h1><p><code>mnist = input_data.read_data_sets("MNIST_data/",one_hot=True)</code></p>
<h1 id="构建网络模型"><a href="#构建网络模型" class="headerlink" title="构建网络模型"></a>构建网络模型</h1><h1 id="x-label分别为图形数据和标签数据"><a href="#x-label分别为图形数据和标签数据" class="headerlink" title="x,label分别为图形数据和标签数据"></a>x,label分别为图形数据和标签数据</h1><p><code>x = tf.placeholder(tf.float32,[None,784])
label = tf.placeholder(tf.float32,[None,10])</code></p>
<h1 id="构建单层网络中的权值和偏置"><a href="#构建单层网络中的权值和偏置" class="headerlink" title="构建单层网络中的权值和偏置"></a>构建单层网络中的权值和偏置</h1><p><code>W = tf.Variable(tf.zeros([784,10]))
b = tf.Variable(tf.zeros([10])</code></p>
<h1 id="本例中无非线性激活函数"><a href="#本例中无非线性激活函数" class="headerlink" title="本例中无非线性激活函数"></a>本例中无非线性激活函数</h1><p><code>y = tf.matmul(x,W)+b</code></p>
<h1 id="定义损失函数为欧氏距离，但这并不是最好的，多分类问题通常使用交叉熵"><a href="#定义损失函数为欧氏距离，但这并不是最好的，多分类问题通常使用交叉熵" class="headerlink" title="定义损失函数为欧氏距离，但这并不是最好的，多分类问题通常使用交叉熵"></a>定义损失函数为欧氏距离，但这并不是最好的，多分类问题通常使用交叉熵</h1><p><code>loss = tf.reduce_mean(tf.square(y-label))</code></p>
<h1 id="若使用交叉熵损失函数"><a href="#若使用交叉熵损失函数" class="headerlink" title="若使用交叉熵损失函数"></a>若使用交叉熵损失函数</h1><p><code>soft_max = tf.nn.softmax(logit, axis=1)
loss = tf.reduce_mean(-label*tf.log(soft_max))</code></p>
<h1 id="用梯度迭代算法"><a href="#用梯度迭代算法" class="headerlink" title="用梯度迭代算法"></a>用梯度迭代算法</h1><p><code>train_step = tf.train.GradientDescentOptimizer(0.005).minimize(loss)</code></p>
<h1 id="用于验证"><a href="#用于验证" class="headerlink" title="用于验证"></a>用于验证</h1><p><code>correct_prediction = tf.equal(tf.argmax(y,1),tf.argmax(label,1))
accuracy = tf.reduce_mean(tf.cast(correct_prediction,tf.float.32))</code></p>
<h1 id="定义会话"><a href="#定义会话" class="headerlink" title="定义会话"></a>定义会话</h1><p><code>sess = tf.Session()</code></p>
<h1 id="初始化所有变量"><a href="#初始化所有变量" class="headerlink" title="初始化所有变量"></a>初始化所有变量</h1><p><code>sess.run(tf.global_variable_initializer())</code></p>
<h1 id="迭代过程"><a href="#迭代过程" class="headerlink" title="迭代过程"></a>迭代过程</h1><p><code>for itr in range(3000):
    batch_xs,batch_ys = mnist.train.next_batch(100)
    sess.run(train_step, feed_dict={x:batch_xs,label:batch_ys})
    if itr%10==0:
        print("step:%6d accuracy:"%iter, sess.run(accuracy, feed_dict={x:mnist.test.images, label:mnist.test.labels}))</code></p>
<h1 id="获取W取值"><a href="#获取W取值" class="headerlink" title="获取W取值"></a>获取W取值</h1><p><code>W_value = sess.run(W.value())</code></p>
<p>//定义一个单层全连接函数<br><code>def full_layer(input_tensor, out_dim, name="full"):
    with tf.variable_scope(name):
        shape = input_tensor.get_shape()as_list()
        W = tf.get_variable('W',(shape[1],out_dim),dtype=tf.float32, initalizer=tf.truncated_normal_initializer(stddev=0.1))
        b = tf.get_variable('b',[out_dim], dtype=tf.float32, initializer=tf.constant_initializer(0))
        out = tf.matmul(input_tensor, W)+b
    return tf.nn.sigmoid(nn)</code></p>
<p>3.6CNN构建<br>//CNN手写识别</p>
<h1 id="预读取MNIST手写字库"><a href="#预读取MNIST手写字库" class="headerlink" title="预读取MNIST手写字库"></a>预读取MNIST手写字库</h1><p><code>from tensorflow.examples.tutorials.mnist import input_data
  mnist = input_data.read_data_sets("MNIST_data",one_hot=True)</code></p>
<p><code>import tensorflow as tf</code></p>
<h1 id="用正态分布随机数初始化变量，本例中仅作为权值"><a href="#用正态分布随机数初始化变量，本例中仅作为权值" class="headerlink" title="用正态分布随机数初始化变量，本例中仅作为权值"></a>用正态分布随机数初始化变量，本例中仅作为权值</h1><p><code>def weight_variable(shape):
    initial=tf.truncated_normal(shape,stddev=0.1)</code></p>
<pre><code>#正态分布
`return tf.Variable(initial)`
</code></pre><h1 id="用常量方式初始化偏置"><a href="#用常量方式初始化偏置" class="headerlink" title="用常量方式初始化偏置"></a>用常量方式初始化偏置</h1><p><code>def bias_variable(shape):
    initial=tf.constant(0.1,shape=shape)</code></p>
<pre><code>#常数分布
   `return tf.Variable(initial)`
</code></pre><h1 id="定义二维卷积的过程"><a href="#定义二维卷积的过程" class="headerlink" title="定义二维卷积的过程"></a>定义二维卷积的过程</h1><p>def conv2d(x,W):<br>    return tf.nn.conv2d(x,W,strides=[1,1,1,1],padding=’SAME’)</p>
<h1 id="定义池化层，简单地说就是选个最大的数，进一步降低自由参数的个数"><a href="#定义池化层，简单地说就是选个最大的数，进一步降低自由参数的个数" class="headerlink" title="定义池化层，简单地说就是选个最大的数，进一步降低自由参数的个数"></a>定义池化层，简单地说就是选个最大的数，进一步降低自由参数的个数</h1><p><code>def max_pool_2x2(x):
    return tf.nn.max_pool(x,ksize=[1,2,2,1],strides=[1,2,2,1],padding='SAME')</code></p>
<p><code>x = tf.placeholder(tf.float32,shape=[100,784])
y = tf.placeholder(tf.float32,shape=[100,10])</code></p>
<p><code>W_conv1 = weight_variable([5,5,1,32])
b_conv1 = bias_variable([32])
x_image = tf.reshape(x,[-1,28,28,1])
y_conv1 = tf.nn.relu(conv2d(x_iamge,W_conv1)+b_conv1)
y_pool1 = max_pool_2x2(y_conv1)</code></p>
<p><code>W_conv2 = weight_variable([5,5,32,64])
b_conv2 = weight_variable([64])
y_conv2 = tf.nn.relu(conv2d(y_pool1,W_conv2)+b_conv2)
y_pool2 = max_pool_2x2(y_conv2)</code></p>
<p><code>y_fc_flat = tf.reshape(y_pool2,[-1,7*7*64])
W_fc1 = weight_variable([7*7*64,10])
b_fc1 = bias_variable([10])
y_fc1 = tf.nn.relu(tf.matmul(y_fc_flat,W_fc1)+b_fc1)</code></p>
<p><code>cross_entropy = tf.reduce_mean(tf.nn.softmax_cross_entropy_with_logits(labels=y,logits=y_fc1))
train_step = tf.train.AdamOptimizer(1e-4).minimize(cross_entropy)</code></p>
<p><code>sess = tf.Session()
init = tf.global_variables_initializer()
sess.run(init)</code></p>
<p><code>for i in range(1000):
    bx,by = mnist.train.next_batch(100)
    sess.run(train_step,feed_dict={x:bx,y:by})</code></p>
<p><code>import numpy as np
import matplotlib.pyplot as plt</code></p>
<h1 id="设置输出风格，为画图美观"><a href="#设置输出风格，为画图美观" class="headerlink" title="设置输出风格，为画图美观"></a>设置输出风格，为画图美观</h1><p><code>import matplotlib  as mpl
mpl.style.use('seaborn-darkgrid')</code></p>
<p><code>val = W_conv1.value()
convVal = np.array(sess.run(val))
convVal = np.reshape(convVal,[5,5,32])
plt.imshow(convVal[:,:,6])
plt.show()</code></p>
<p>3.8多架构运行<br>//GPU使用<br>GPU可以加速深度学习作业的训练速度，如果服务器有多个GPU,那么tensorflow默认使用全部<br>使用部分GPU:</p>
<p>python程序启动时调用：<br><code>CUDA_VISIBLE_DEVICES=0.2.3 python script.py</code></p>
<p>python代码内进行调用：<br><code>import os
os.environ["CUDA_VISIBLE_DEVICES"]="1"</code></p>
<p>//配置GPU显存<br>某些情况下，多作业或者共享GPU的场景中，可以控制tf使用GPU显存大小<br><code>gpuOptions = tf.GPUOptions(per_process_gpu_memory_fraction=0.8)
sess = tf.Session(config=tf.ConfigProto(gpu_options=gpuOptions))</code></p>
<p>//GPU运行代码</p>
<h1 id="将变量的定义和分配定义到GPU上进行"><a href="#将变量的定义和分配定义到GPU上进行" class="headerlink" title="将变量的定义和分配定义到GPU上进行"></a>将变量的定义和分配定义到GPU上进行</h1><p><code>with tf.device('/gpu:0'):
    W = tf.get_variable('W',(in_dim,out_dim),dtype=tf.float32,initializer=tf.truncated_normal_initializer(stddev=0.1))
    b = tf.get_variable('b'),[out_dim],dtype=tf.float32,initializer=tf.constant_initializer(0))
    net = tf.matmul(input_tensor,W)+b</code></p>
<h1 id="在CPU上计算激活函数"><a href="#在CPU上计算激活函数" class="headerlink" title="在CPU上计算激活函数"></a>在CPU上计算激活函数</h1><p><code>with tf.device('/cpu:0'):
    net = tf.nn.sigmoid(net)</code></p>
<p>//多CPU使用，多设备计算<br>//利用标号简单的区分并运行</p>
<h1 id="在CPU0上计算"><a href="#在CPU0上计算" class="headerlink" title="在CPU0上计算"></a>在CPU0上计算</h1><p><code>with tf.device('/cpu:0')
    ...
    net = tf.nn.sigmoid(net)</code></p>
<h1 id="在CPU1上计算"><a href="#在CPU1上计算" class="headerlink" title="在CPU1上计算"></a>在CPU1上计算</h1><p><code>with tf.device('/cpu:1')
    ...
    net = tf.nn.sigmoid(net)</code></p>
<p>//在集群上运行，需要在多个主机上准备多份代码，代码前面部分相同，后续有所不同<br>//定义多主机运行参数</p>
<h1 id="这里的地址形式为IP-Port"><a href="#这里的地址形式为IP-Port" class="headerlink" title="这里的地址形式为IP:Port"></a>这里的地址形式为IP:Port</h1><p><code>cluster = tf.train.ClusterSpectf.train.ClusterSpec({
    "worker":[
        "xx.xx.xx.xx:2222",    #/job:worker/task:0
        "xx.xx.xx.xx:2222",    #这里job的名称为自定义
        "xx.xx.xx.xx:2222"    #task编号同样需在Server中定义
        ],
    "ps":[
        "xx.xx.xx.xx:2222",
        "xx.xx.xx.xx:2222"
        ]})
server = tf.train.Server(cluster, job_name="worker", task_index=0)</code></p>
<p>//定义第二个主机参数</p>
<h1 id="这里的地址形式为IP-Port-1"><a href="#这里的地址形式为IP-Port-1" class="headerlink" title="这里的地址形式为IP:Port"></a>这里的地址形式为IP:Port</h1><p><code>cluster = tf.train.ClusterSpectf.train.ClusterSpec({
    "worker":[
        "xx.xx.xx.xx:2222",    #/job:worker/task:0
        "xx.xx.xx.xx:2222",    #这里job的名称为自定义
        "xx.xx.xx.xx:2222"    #task编号同样需在Server中定义
        ],
    "ps":[
        "xx.xx.xx.xx:2222",
        "xx.xx.xx.xx:2222"
        ]})
server = tf.train.Server(cluster, job_name="worker", task_index=1)</code></p>
<p>//不同设备的运行代码<br><code>with tf.device('/job:worker/task:0/cpu:0'):
    ...</code></p>
<p>//将不同的任务分配到不同的计算节点上<br>//分配计算任务<br><code>with tf.device(tf.train.replica_device_setter(
    worker_device="/job:worker/task:%d" %task_index,cluster=cluster)</code></p>
<p>//函数replica_device_setter会将变量参数的定义部分自动定义到ps服务中，后续需要定义Session,用于执行这个过程<br>//多主机运行</p>
<h1 id="定义句柄，迭代多少步后停止迭代"><a href="#定义句柄，迭代多少步后停止迭代" class="headerlink" title="定义句柄，迭代多少步后停止迭代"></a>定义句柄，迭代多少步后停止迭代</h1><p><code>hooks = [tf.train.StopAtStepHook(last_step=1000000)]</code></p>
<h1 id="MonitoredTrainingSession函数会完成会话初始化工作"><a href="#MonitoredTrainingSession函数会完成会话初始化工作" class="headerlink" title="MonitoredTrainingSession函数会完成会话初始化工作"></a>MonitoredTrainingSession函数会完成会话初始化工作</h1><h1 id="保存checkpoint-恢复checkpoint-异常判断等"><a href="#保存checkpoint-恢复checkpoint-异常判断等" class="headerlink" title="保存checkpoint,恢复checkpoint,异常判断等"></a>保存checkpoint,恢复checkpoint,异常判断等</h1><h1 id="这里需要定义master主机，定义保存、控制操作的master"><a href="#这里需要定义master主机，定义保存、控制操作的master" class="headerlink" title="这里需要定义master主机，定义保存、控制操作的master"></a>这里需要定义master主机，定义保存、控制操作的master</h1><p><code>with tf.train.MonitroedTrainingSession(
    master=server.target,
    is_chief=(task_index==0),
    checkpoint_dir="dir/to/cp",
    hooks=hooks) as mon_sess:
    ...</code></p>
<p>注：在程序运行过程中，需要认为将程序分配到各个主机上，依次运行各个主机</p>
<p>//队列用于数据读取和处理，队列可以是先进先出队列，也可以是随机队列，用于随机化输出<br>//tf中队列的操作是对于训练前的过程而言的，有以下作用<br>1.多线程数据预处理并将其推入队列<br>2.在执行过程中，队列不断提供训练数据<br>//简单实例说明队列使用<br><code>def simple_shuffle_batch(source,capacity,batch_size=10):</code></p>
<pre><code>#定义随机序列
`queue = tf.RandomShuffleQueue(
    capacity=capacity,
    min_after_dequeue=int(0.9*capacity),
    shapes=source.shape,
    dtypes=source.dtype)`
#定义enqueue过程
`enqueue = queue.enqueue(source)`
#定义执行进程个数
`num_threads = 4
qr = tf.train.QueueRunner(queue,[enqueue]*num_threads)`
#声明Queue runner,使得其可以被执行
`tf.train.add_queue_runner(qr)`
#获取数据
`return queue.dequeue_many(batch_size)`
</code></pre><h1 id="产生测试数据"><a href="#产生测试数据" class="headerlink" title="产生测试数据"></a>产生测试数据</h1><p><code>input = tf.constant(list(range(100)))
input = tf.data.Dataset.from_tensor_slices(input)
input = input.make_one_shot_iterator().get_next()</code></p>
<h1 id="定义函数"><a href="#定义函数" class="headerlink" title="定义函数"></a>定义函数</h1><p><code>get_batch = simple_shuffle_batch(input,capacity=20)</code></p>
<h1 id="定义session"><a href="#定义session" class="headerlink" title="定义session"></a>定义session</h1><p><code>with tf.train.MonitoredSession() as sess:
    while not sess.should_stop():
        print(sess.run(get_batch))</code></p>
<p>注：队列操作可以使得数据读取过程得到并行的优化，这对于提升程序的运行速度是很有利的。</p>
<p>//tf相关扩展<br>4.2.1 tf Layers<br>//全连接网络</p>
<h1 id="layers定义全连接网络"><a href="#layers定义全连接网络" class="headerlink" title="layers定义全连接网络"></a>layers定义全连接网络</h1><p><code>net = tf.layers.dense(inputs=net, units=units, activation=tf.nn.relu)</code></p>
<h1 id="卷积网络"><a href="#卷积网络" class="headerlink" title="卷积网络"></a>卷积网络</h1><p><code>net = tf.layers.conv2d(
    inputs=net, #输入
    filters=n_features, #输出特征数
    kernel-size=[5, 5], #卷积核心大小
    padding="same", #边界
    activation=tf.nn.relu #激活函数
    )</code></p>
<p>//前馈神经网络函数</p>
<h1 id="二维最大池化"><a href="#二维最大池化" class="headerlink" title="二维最大池化"></a>二维最大池化</h1><p><code>net = tf.layers.max_pooling2d(...)</code></p>
<h1 id="二维平均池化"><a href="#二维平均池化" class="headerlink" title="二维平均池化"></a>二维平均池化</h1><p><code>net = tf.layers.average_pooling2d(...)</code></p>
<h1 id="二维卷积"><a href="#二维卷积" class="headerlink" title="二维卷积"></a>二维卷积</h1><p><code>net = tf.layers.conv2d(...)</code></p>
<h1 id="dropout"><a href="#dropout" class="headerlink" title="dropout"></a>dropout</h1><p><code>net = tf.layers.dropout(...)</code></p>
<h1 id="展开"><a href="#展开" class="headerlink" title="展开"></a>展开</h1><p><code>net = tf.layers.flatten(...)</code></p>
<h1 id="BN"><a href="#BN" class="headerlink" title="BN"></a>BN</h1><p><code>net = tf.layers.batch_normalization(...)</code></p>
<p>4.2.2 tf Slim</p>
<h1 id="卷积函数"><a href="#卷积函数" class="headerlink" title="卷积函数"></a>卷积函数</h1><p><code>def conv2d_layer(input_tensor, size=1, feature=128, name='conv1d'):
    with tf.variable_scope(name):
        shape = input_tensor.get_shape.as_list()
        kernel = tf.get_variable('kernel', (size, size, shape[-1], feature), dtype=tf.float32, initializer=tf.truncated_normal_initializer(stddev=0.1))
        b = tf.get_variable('b', [feature], dtype=tf.float32, initializer=tf.constant_initializer(0))
        out = tf.nn.conv2d(input_tensor, kernel, strides=[1,2,2,1],padding='SAME')+b
    return tf.nn.relu(out)</code></p>
<h1 id="全连接函数"><a href="#全连接函数" class="headerlink" title="全连接函数"></a>全连接函数</h1><p><code>def full_layer(input_tensor, out_dim, name='full'):
    with tf.variable_scope(name):
        shape = input_tensor.get_shape.as_list()
        W = tf.get_variable('W', (shape[1], out_dim), dtype=tf.float32, initializer=tf.truncated_normal_initializer(stddev=0.1))
        b = tf.get_variabel('b', [out_dim], dtype=tf.float32, initializer=tf.constant_initializer(0))
        out = tf.matmul(input_tensor, W)+b
    return out</code></p>
<p>//slim实现卷积，tfv2取消该库</p>
<h1 id="引入slim库"><a href="#引入slim库" class="headerlink" title="引入slim库"></a>引入slim库</h1><p><code>import tensorflow.contrib.slim as slim</code></p>
<h1 id="定义卷积层"><a href="#定义卷积层" class="headerlink" title="定义卷积层"></a>定义卷积层</h1><p><code>net = slim.conv2d(inputs, 16, 4, strides=2, activation_fn=tf.nn.relu, scope='conv1')</code></p>
<h1 id="加入池化层"><a href="#加入池化层" class="headerlink" title="加入池化层"></a>加入池化层</h1><p><code>net = tf.nn.max_pool(net, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding='SAME')</code></p>
<p><code>net = slim.conv2d(net, 32, 4, strides=2, activation_fn=tf.nn.relu, scope='conv2')
net = tf.nn.max_pool(net, ksize=[1, 2, 2, 1], strides=[1, 2, 2, 1], padding='SAME')</code></p>
<h1 id="flatten层，用于将三维的图形数据展开成一维数据，用于全连接层"><a href="#flatten层，用于将三维的图形数据展开成一维数据，用于全连接层" class="headerlink" title="flatten层，用于将三维的图形数据展开成一维数据，用于全连接层"></a>flatten层，用于将三维的图形数据展开成一维数据，用于全连接层</h1><p><code>net = slim.flatten(net)</code></p>
<h1 id="全连接层"><a href="#全连接层" class="headerlink" title="全连接层"></a>全连接层</h1><p><code>y = slim.fully_connected(net, 10, activation_fn=line, scope='full', reuse=False)</code></p>
<p>4.2.3 tfLearn<br>//tflearn抽象层次更高，代码可读性更好,其是一个完整的生态<br>//基础网络架构</p>
<h1 id="全连接"><a href="#全连接" class="headerlink" title="全连接"></a>全连接</h1><p><code>net = tflearn.fully_connected(...)</code></p>
<h1 id="卷积"><a href="#卷积" class="headerlink" title="卷积"></a>卷积</h1><p><code>net = tflearn.conv_2d(...)</code></p>
<h1 id="LSTM"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h1><p><code>net = tflearn.lstm(...)</code></p>
<h1 id="dropout-1"><a href="#dropout-1" class="headerlink" title="dropout"></a>dropout</h1><p><code>net = tflearn.dropout(...)</code></p>
<p>//输入函数<br><code>network = tflearn.input_data(shape=[None, 28, 28, 1], name='input')</code></p>
<p>//优化部分</p>
<h1 id="定义优化过程"><a href="#定义优化过程" class="headerlink" title="定义优化过程"></a>定义优化过程</h1><p><code>network = tflearn.layers.estimator.regression(
    network,
    optimizer='adam', #优化方法
    learning_rate=0.01, #学习率
    loss='categorical_crossentropy', #损失函数
    name='target')</code></p>
<p>//利用tflearn完成手写数字的识别任务<br><code>import tflearn
from tflearn.layers.core import input_data,dropout, fully_connected
from tflearn.layers.conv import conv_2d, , max_pool_2d
from tflearn.layers.normalization import local_response_normalization
from tflearn.layers.estimator import regression</code></p>
<h1 id="载入并处理数据"><a href="#载入并处理数据" class="headerlink" title="载入并处理数据"></a>载入并处理数据</h1><p><code>import tflearn.datasets.mnist as mnist
X, Y, testX, testY = mnist.load_data(one_hot=True)</code></p>
<h1 id="转换为二维图形"><a href="#转换为二维图形" class="headerlink" title="转换为二维图形"></a>转换为二维图形</h1><p><code>X = X.reshape([-1, 28, 28, 1])
testX = testX.reshape([-1, 28, 28, 1])</code></p>
<h1 id="建立神经网络"><a href="#建立神经网络" class="headerlink" title="建立神经网络"></a>建立神经网络</h1><p><code>network = tflearn.input_data(shape=[None, 28, 28, 1], name='input')
network = conv_2d(network, 32, 3, activation='relu', regularizer='L2')
network = max_pool_2d(network)
network = local_response_normalization(network)
network = fully_connected(network, 128, activation='tanh')
network = dropout(network, 0.8)
network = fully_connected(network, 256, activation='tanh')
network = dropout(network, 0.8)
network = fully_connected(network, 10, activation='softmax')</code></p>
<h1 id="定义优化过程-1"><a href="#定义优化过程-1" class="headerlink" title="定义优化过程"></a>定义优化过程</h1><p><code>network = regression(
    network,
    optimizer='adam',
    learning_rate=0.01,
    loss='categorical_crossentropy',
    name='target')</code></p>
<h1 id="训练过程"><a href="#训练过程" class="headerlink" title="训练过程"></a>训练过程</h1><p><code>model = tflearn.DNN(network, tensorboard_verbose=0)
model.fit({'input':X}, {'target':Y}, n_epoch=20,
    validation_set=({'input':testX}, {'target':testY}),
    snapshot_step=100, show_metric=True, run_id='convnet_mnist')</code></p>
<p>//Keras代码可读性好，并且横跨多个机器学习框架，但其扩展性较差<br>//引入库<br><code>from keras.layers import Dense, Dropout, Flatten
from keras.layers import Conv2D, MaxPooling2D</code></p>
<p>//Keras直接顺序加入模型，无需通过数据方式进行传递<br>//基础网络层<br><code>from keras.models import Sequential
model = Sequential()</code></p>
<h1 id="加入卷积层"><a href="#加入卷积层" class="headerlink" title="加入卷积层"></a>加入卷积层</h1><p><code>model.add(Conv2D(...))</code></p>
<h1 id="加入池化层-1"><a href="#加入池化层-1" class="headerlink" title="加入池化层"></a>加入池化层</h1><p><code>model.add(MaxPooling2D(...))</code></p>
<h1 id="加入全连接层"><a href="#加入全连接层" class="headerlink" title="加入全连接层"></a>加入全连接层</h1><p><code>model.add(Dense(...))</code></p>
<h1 id="dropout-2"><a href="#dropout-2" class="headerlink" title="dropout"></a>dropout</h1><p><code>model.add(Dropout(0.25))</code></p>
<p>//定义model后可直接加入多种层进行操作，同样其需要定义训练函数<br>//定义优化过程<br><code>from keras.optimizers import SGD</code></p>
<h1 id="定义迭代算法"><a href="#定义迭代算法" class="headerlink" title="定义迭代算法"></a>定义迭代算法</h1><p><code>sgd = SGD(lr=0.01, decay=1e-6, momentum=0.9, nesterov=True)
model.compile(loss='categorical_crossentropy', optimizer=sgd)</code></p>
<h1 id="训练过程-1"><a href="#训练过程-1" class="headerlink" title="训练过程"></a>训练过程</h1><p><code>model.fit(x_train, y_train, batch_szie=32, epochs=10)</code></p>
<h1 id="评估训练效果"><a href="#评估训练效果" class="headerlink" title="评估训练效果"></a>评估训练效果</h1><p><code>score = model.evaluate(x_test, y_test, batch_size=32)</code></p>
<p>//完整代码<br><code>import keras
from keras.models import Sequential
from keras.layers import Dense, Dropout, Flatten
from keras.layers import Conv2D, MaxPooling2D
from keras.optimizers import SGD</code></p>
<h1 id="这里utils为自己定义的库函数，用于载入数据"><a href="#这里utils为自己定义的库函数，用于载入数据" class="headerlink" title="这里utils为自己定义的库函数，用于载入数据"></a>这里utils为自己定义的库函数，用于载入数据</h1><p><code>import utils
X, Y, testX, testY = utils.load_data(one_hot=True)
model = Sequential()</code></p>
<h1 id="定义神经网络过程"><a href="#定义神经网络过程" class="headerlink" title="定义神经网络过程"></a>定义神经网络过程</h1><p><code>model.add(Conv2D(32, (3, 3), activation='relu', input_shape=(100, 100, 3)))
model.add(Conv2D(32, (3, 3), activation='relu'))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Dropout(0.25))</code></p>
<p><code>model.add(Conv2D(64, (3, 3), activation='relu'))
model.add(Conv2D(64, (3, 3), activatin='relu'))
model.add(MaxPooling2D(pool_size=(2, 2)))
model.add(Dropout(0.25))</code></p>
<h1 id="展开为一维数据用于全连接层"><a href="#展开为一维数据用于全连接层" class="headerlink" title="展开为一维数据用于全连接层"></a>展开为一维数据用于全连接层</h1><p><code>model.add(Flatten())
model.add(Dense(256, activation='relu'))
model.add(Dropout(0.5))
model.add(Dense(10, activation='softmax'))</code></p>
<h1 id="梯度迭代算法"><a href="#梯度迭代算法" class="headerlink" title="梯度迭代算法"></a>梯度迭代算法</h1><p><code>sgd = SGD(lr=0.01, decay=1e-6, momentum=0.9, nesterov=True)
model.compile(loss='categorical_crossentropy', optimizer=sgd)</code></p>
<h1 id="训练过程-2"><a href="#训练过程-2" class="headerlink" title="训练过程"></a>训练过程</h1><p><code>model.fit(x_train, y_train, batch_size=32, epochs=10)</code></p>
<h1 id="效果评估"><a href="#效果评估" class="headerlink" title="效果评估"></a>效果评估</h1><p><code>score = model.evaluate(x_test, y_test, batch_size=32)</code></p>
<p>4.3 Tensorboard与问题监控<br>//tensorboard最重要的作用就在于观察训练过程中的各种问题并改善，包括梯度消失、过拟合等问题<br>//获取所有可训练的参数<br><code>var_list_w = [var for var in tf.trainable_variables() if 'w' in var.name]
var_list_b = [var for var in tf.trainable_variables() if 'b' in var.name]</code></p>
<p>//利用定义的梯度算法来计算梯度<br><code>gradient_w = optimizer.compute_gradients(loss, var_list=var_list_w)
gradient_b = optimizer.compute_gradients(loss, var_list=var_list_b)</code></p>
<p>//返回的梯度是一个列表，可对其进行各种列表操作<br>//加入summary操作<br><code>for idx, itr_g in enumerate(gradient_w):
    variable_summaries(itr_g[0], 'layer%d-w-grad'%idx)
for idx, itr_g in enumerate(gradient_b):
    variable_summaries(itr_g[0], 'layer%d-b-grad'%idx</code></p>
<p><code>for idx, itr_g in enumerate(var_list_w):
    variable_summaries(itr_g, 'layer%d-w-grad'%idx)
for idx, itr_g in enumerate(var_list_b):
    variable_summaries(itr_g, 'layer%d-b-grad'%idx)</code></p>
<p>4.4改善深度神经网络<br>//出现梯度消失一种最有效的方式就是进行BN操作<br>//batchnorm层<br><code>net = tf.contrib.layers.batch_norm(net)</code></p>
<p>//加入BN层的神经网络</p>
<h1 id="对于sigmoid激活函数来讲，BN操作效果可能不理想"><a href="#对于sigmoid激活函数来讲，BN操作效果可能不理想" class="headerlink" title="对于sigmoid激活函数来讲，BN操作效果可能不理想"></a>对于sigmoid激活函数来讲，BN操作效果可能不理想</h1><p><code>net = slim.fully_connected(x, 4, activation_fn=tf.nn.sigmoid, scope='full1', reuse=False)
net = tf.contrib.layers.batch_norm(net)</code></p>
<p><code>net = slim.fully_connected(net, 8, activation_fn=tf.nn.sigmoid, scope='full2', reuse=False)
net = tf.contrib.layers.batch_norm(net)</code></p>
<p><code>net = slim.fully_connected(net, 8, activation_fn=tf.nn.sigmoid, scope='full3', reuse=False)
net = tf.contrib.layers.batch_norm(net)</code></p>
<p><code>net = slim.fully_connected(net, 4, activation_fn=tf.nn.sigmoid, scope='full4', reuse=False)
net = tf.contrib.layers.batch_norm(net)</code></p>
<p><code>net = slim.fully_connected(net, 3, activation_fn=tf.nn.sigmoid, scope='full5', reuse=False)</code></p>
<p><code>loss = tf.reduce_mean(tf.square(y-label))</code></p>
<p>4.5性能优化建议<br>//训练前的优化技巧<br>1.网络结构优化<br>Relu和BN能够有效加快神经网络训练速度<br>卷积核心的选取可以从大的卷积核心修改为多个小的卷积核心<br>将nxn修改为nx1+1xn，减少参数量，不同的输出内容之间可以进行concat<br>引入跨层支路解决梯度问题（ResNet)<br>2.初始值的选取<br>不好的初始值对训练的影响非常大，有效的初始化方法包括xavier初始化方法和He初始化方法<br>3.数据预处理<br>包括去均值和方差均衡<br>//训练过程中的优化技巧<br>1）优化算法的选择<br>Adam<br>2）学习率的选取<br>从大的步长开始进行迭代，逐步减少学习率<br>3）Batchsize选择<br>4）model ensembles<br>使用不同初始值同时训练多个模型，预测过程中将多个模型输出结果做平均，有效提升结果精度<br>5)dropout选择<br>从0.5附近进行调整，调整步长为0.05左右</p>
<p>//物体检测<br>1.传统检测方法<br>2001年，基于Haar特征和Adaboost检测方法引起轰动<br>2012年之前，三方面不断创新与优化：特征的设计更新、检测窗口的选择、分类器的设计更新</p>
<p>2.深度学习的物体检测<br>1）基于分类的物体检测<br>处理过程：图像被分解成多个小区域，每个小区域将运行一个分类算法以确定区域是否包含待检测物体，之后再在这个小区域的周围确认物体的边界框。代表算法：R-CNN、Fast-RCNN、Faster-RCNN<br>2) 基于回归的物体检测<br>将问题建模为回归问题，通过深度神经网络直接预测出边界框和所属类别的置信度。代表算法：SSD、YOLO模型</p>
<p>//YOLO模型<br>官网：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://pjreddie.com/darknet/yolo/">https://pjreddie.com/darknet/yolo/</a><br>//选讲tiny YOLO v1模型，由9个卷积层和3个全连接层组成，每个卷积层都由卷积层、LeakyRelu和Max Pooling操作组成，前9个卷积层可被理解为特征提取器，最后三个全连接层可被理解为预测边界框的回归器。<br>参考论文：You Only Look Once:Unified, Real-Time Object Detection<br>参考实例：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/xslittlegrass/CarND-Vehicle-Detection">https://github.com/xslittlegrass/CarND-Vehicle-Detection</a><br>模型参数：45089374<br>深度学习框架：Keras 1.2.2</p>
<p>//构建YOLO模型网络结构<br><code>import keras
from keras.models import Sequential
from keras.layers.convolutional import Convlution2D, MaxPooling2D
from keras.layers.advanced_activations import LeakyReLU
from keras.layers.core import Flatten, Dense, Activation, Reshape
from utils import load_weights, Box, yolo_net_out_to_car_boxes, draw_box
def construct_yolo_model():
    keras.backend.set_image_dim_ordering('th')
    model = Sequential()
    model.add(Convolution2D(16, 3, 3, input_shape=(3, 448, 448), border_mode='same', subsample=(1, 1)))
    model.add(LeakyReLU(alpha=0.1))
    model.add(MaxPooling2D(pool_size=(2, 2)))</code></p>
<pre><code>model.add(Convolution2D(32, 3, 3, border_mode='same'))
model.add(LeakyReLU(alpha=0.1))
model.add(MaxPooling2D(pool_size=(2, 2), border_mode='valid'))

model.add(Convolution2D(32, 3, 3, border_mode='same'))
model.add(LeakyReLU(alpha=0.1))
model.add(MaxPooling2D(pool_size=(2, 2), border_mode='valid'))

model.add(Convolution2D(64, 3, 3, border_mode='same'))
model.add(LeakyReLU(alpha=0.1))
model.add(MaxPooling2D(pool_size=(2, 2), border_mode='valid'))

model.add(Convolution2D(128, 3, 3, border_mode='same'))
model.add(LeakyReLU(alpha=0.1))
model.add(MaxPooling2D(pool_size=(2, 2), border_mode='valid'))

model.add(Convolution2D(256, 3, 3, border_mode='same'))
model.add(LeakyReLU(alpha=0.1))
model.add(MaxPooling2D(pool_size=(2, 2), border_mode='valid'))

model.add(Convolution2D(512, 3, 3, border_mode='same'))
model.add(LeakyReLU(alpha=0.1))
model.add(MaxPooling2D(pool_size=(2, 2), border_mode='valid'))

model.add(Convolution2D(1024, 3, 3, border_mode='same'))
model.add(LeakyReLU(alpha=0.1))

model.add(Convolution2D(1024, 3, 3, border_mode='same'))
model.add(LeakyReLU(alpha=0.1))

model.add(Convolution2D(1024, 3, 3, border_mode='same'))
model.add(LeakyReLU(alpha=0.1

model.add(Flatten())
model.add(Dense(256))
model.add(Dense(4096))
model.add(LeakyReLU(alpha=0.1))
model.add(Dense(1470))
model.summary()
return model
</code></pre><p>注：网络的输入是形状为（3,448,448)的图像，其输出是一个1470维度的向量，它包含预测边界框、物体类别信息。1470矢量被分成三个部分，分别给出了所属类别概率、置信度和边框坐标。这三个部分进一步划分为49个小区域，与每个单元的预测相对应。<br>输出向量信息组织方式：<br><code>probability:49*20=980</code><br>判断类别，20个类别<br><code>confidence:49*2=98</code><br>是否包含物体（0,1）<br><code>box coordinates:49*8=392
(x_min,y_min,x_max,y_max),(c_x,c_y,w,h)</code></p>
<p>8.4.3车辆图像数据探索<br>1.车辆视频数据预处理<br>//预处理及可视化图像<br><code>def visualize_images():
    imagePath = './test_images/test1.jpg'
    image = plt.imread(imagePath)</code></p>
<pre><code>#去除顶部和底部图片
`image_crop = image[300:650,500:,:]`
#将图片转换为模型所需要的输入格式
`resized = cv2.resize(image_crop, (448, 448))
f1,(ax11,ax22,ax33) = plt.subplot(1, 3, figsize=(16, 6))
ax11.imshow(image)
ax22.imshow(image_crop)
ax33.imshow(resized)
pylab.show()
return resized`
</code></pre><p>8.4.5迁移学习<br>通过迁移学习加载使用Pre-trained YOLO模型进行行车检测。具体做法是将pre-trained模型中的权重加载进之前构造的模型结构中，官网提供的权重，可以通过脚本解析成Keras能够加载的格式。<br>//加载YOLO模型权重<br>`def load_model_weights(model):</p>
<pre><code>#预训练权重网址：https://pjreddie.com/darknet/yolo/
load_weights(model, './yolo-tiny.weights')`
</code></pre><p>//加载模型权重的具体逻辑<br><code>def load_weights(model, yolo_weight_file):
    data = np.fromfile(yolo_weight_file, np.float32)
    data = data[4:]
    index = 0
    for layer in model.layers:
        shape = [w.shape for w in layer.get_weights()]
        if shape !=[]:
            kshape, bshape = shape
            bia = data[index:index+np.prod(bshape)].reshape(bshape)
            index += np.prod(bshape)
            ker = data[index:index:index+np.prod(kshape)].reshape(kshape)
            index += np.prod(kshape)
            layer.set_weights([ker, bia])</code></p>
<p>//模型推断<br>//使用模型进行在线推断，预测出车辆区域<br>`def inference_image(model, resized):</p>
<pre><code>#转置
batch = np.transpose(resized, (2, 0, 1))
#将像素值变换到-1~1
batch = 2*(batch/255.) - 1
#将一张图片转为数组
batch = np.expand_dims(batch, axis=0）
out = model.predict(batch)
return out`
</code></pre><p>//绘制检测结果<br>//将上述的预测结果转换为边框坐标，同时基于阈值进行预测<br><code>th = 0.17
boxes = yolo_net_to_out_to_car_boxes(out[0], threshold=th)</code></p>
<p>//定义box边框对象，判断是否保留预测的边框结果通过c,在图像上绘制车辆位置通过对象中的坐标信息</p>
<h1 id="定义box类，存储边框信息和物体检测类别等信息"><a href="#定义box类，存储边框信息和物体检测类别等信息" class="headerlink" title="定义box类，存储边框信息和物体检测类别等信息"></a>定义box类，存储边框信息和物体检测类别等信息</h1><p>`class Box:<br>def <strong>init</strong>(self):</p>
<pre><code>#x, y轴坐标
self.x, self.y = float(), float()
#边框宽度和长度
self.w, self.h = float(), float()
#置信度
self.c = float()
#所属类别概率
self.prob = float()`
</code></pre><p>//通过yolo_net_to_out_to_car_boxes方法，将预测出的Vector转换为Box对象信息。其核心逻辑是解析模型预测输出向量中的坐标、类别和置信度信息<br>//置信度大于阈值边界框则进行保留<br><code>class_num = 6 #yolo模型可以预测多种类别，6为车辆所属类别
p = probs[grid, :] *bx.c
if p[class_num]&gt;=threshold:
    bx.prob = p[class_num]
    boxes.append(bx)</code></p>
<p>//将结果绘制在图像上<br><code>def visualize_image_car_detection(boxes):
    imagePath = './test_images/test1.jpg'
    image = plt.imread(imagePath)
    f, (ax1, ax2) = plt.subplots(1, 2, figsize=(16, 6))
    ax1.imshow(image)
    ax2.imshow(draw_box(boxes, plt.imread(imagePath), [[500, 1280],[300,650]]))
    pylab.show()</code></p>
<p>//将边框绘制在图像上<br><code>def draw_box(boxes, im, crop_dim):
    imgcv = im
    [xmin, xmax] = crop_dim[0]
    [ymin, ymax] = crop_dim[1]
    for b in boxes:
        h, w, _ = imgcv.shape
        left = int((b.x-b.w/2.)*w)
        right = int((b.x+b.w/2.)*w)
        top = int((b.y-b.h/2.)*h)
        bot = int((b.y+b.h/2.)*h)
        left = int(left*(xmax-xmin)/w+xmin)
        right = int(right*(xmax-xmin)/w+xmin)
        top = int(top*(ymax-ymin)/h+ymin)
        bot = int(bot*(ymax-ymin)/h+ymin)
        if left&lt;0 : left=0
        if right&gt;w-1 : right=w-1
        if top&lt;0 : top=0
        if bot&gt;h-1 : bot=h-1
        thick = int((h+w)//150)
        cv2.rectangle(imgcv, (left, top), (right, bot), (255,0,0), thick)
    return imgcv</code></p>
<p>8.5.1英伟达End to End模型<br>End to End的好处：通过缩减人工预处理和后续处理，尽可能使模型从原始输入到输出，使得其根据网络模型能够有足够多的空间进行自动调节，从而减少基于规则的复杂变化。<br>缺点：可解释性较差，准确度和精度不容易受控制。<br>//构建英伟达模型<br><code>import tensorflow as tf
import keras
from keras.models import Sequential
from keras.layers import Dense, Activation, Flatten, Lambda
from keras.layers import Conv2D, Dropout
from keras import losses
def nvida_model():
    model = Sequential()
    model.add(Lambda(lambda x: x/127.5-1., input_shape=(img_height, img_width, img_channels)))
    model.add(Conv2D(24, kernel_size=(5, 5), strides=(2, 2), padding='valid', kernel_initializer='he_normal', activation='elu'))
    model.add(Conv2D(36, kernel_size=(5, 5), strides=(2, 2), padding='valid', kernel_initializer='he_normal', activation='elu'))
    model.add(Conv2D(48, kernel_size=(5, 5), strides=(2, 2), padding='valid', kernel_initializer='he_normal', activation='elu'))
    model.add(Conv2D(64, kernel_size=(5, 5), strides=(2, 2), padding='valid', kernel_initializer='he_normal', activation='elu'))
    model.add(Conv2D(64, kernel_size=(5, 5), strides=(2, 2), padding='valid', kernel_initializer='he_normal', activation='elu
    model.add(Flatten())
    model.add(Dense(1164, kernel_initializer='he_normal', activation='elu'))
    model.add(Dense(100, kernel_initializer='he_normal', activation='elu'))
    model.add(Dense(50, kernel_initializer='he_normal', activation='elu'))
    model.add(Dense(10, kernel_initializer='he_normal', activation='elu'))
    model.add(Dense(1, kernel_initializer='he_normal'))
    model.compile(loss='mse', optimizer='Adadelta')
    return model</code></p>
<p>//8.5.3数据分析<br>1）转向控制数据分布</p>
<h1 id="绘制转向分布"><a href="#绘制转向分布" class="headerlink" title="绘制转向分布"></a>绘制转向分布</h1><p><code>def steering_distribution():
    wheel_sig = pd.read_csv(params.data_dir+'/epoch01_steering.csv')
    wheel_sig.head()
wheel_sig.wheel.hist(bins=50)</code></p>
<p>2)数据变化幅度</p>
<h1 id="绘制转向变化幅度"><a href="#绘制转向变化幅度" class="headerlink" title="绘制转向变化幅度"></a>绘制转向变化幅度</h1><p><code>def angel_visualize():
    wheel_sig = pd.read_csv(params.data_dir+'/epoch01_steering.csv')
    wheel_sig.plot(x='frame', y='wheel')
    plt.show()</code></p>
<p>8.5.4读入视频，并处理图像<br>//使用OpenCV从视频中提取图像，以及与其对应的转向角度并返回</p>
<h1 id="提取图像并处理"><a href="#提取图像并处理" class="headerlink" title="提取图像并处理"></a>提取图像并处理</h1><p>`imgs = []<br>wheels = []<br>epochs = [10]<br>for epoch in epochs:<br>    vid_path = utils.join_dir(params.data_dir, ‘epoch{:0&gt;2}_front.mp4’.format(epoch))<br>    assert os.path.isfile(vid_path)<br>    frame_count = frame_count_func(vid_path)<br>    cap = cv2.VideoCapture(vid_path)<br>    for frame_id in range(frame_count):<br>        while True:</p>
<pre><code>    #通过OpenCV中的VideoCapture进行视频中图像的提取
        ret, img = cap.read()
        if not ret:
            break
        #用户可以自定义对图像的处理、扩展和增强操作
        img = a_image_convert.img_preprocess(img, color_mode, flip=False)
        imgs.append(img)
    csv.path = os.path.join(data_dir, 'epoch{:0&gt;2}_steering.csv'.format(epoch))
    rows = pd.read_csv(csv.path)
    yy = rows['wheel'].values
    wheels.extend(yy)
    cap.release()
imgs = np.array(imgs)
wheels = np.array(wheels)
wheels = np.reshape(wheels, (len(wheels), 1)
return imgs, wheels`
</code></pre><p>8.5.5深度学习模型构建与训练<br>//训练模型<br>`def training(model, X_train_RGB, y_train_RGB):<br>    RGB_model = model<br>    time_start = time.time()</p>
<pre><code>#fit the model
RGB_history = RGB_model.fit(X_train_RGB, y_train_RGB, epochs=30, batch_size=batch_size)
return RGB_model, RGB_history`
</code></pre><p>//可视化结果</p>
<h1 id="将训练过程中的loss误差进行可视化"><a href="#将训练过程中的loss误差进行可视化" class="headerlink" title="将训练过程中的loss误差进行可视化"></a>将训练过程中的loss误差进行可视化</h1><p><code>def visualize_label(RGB_history):
    print(RGB_history.history['loss']
    plt.figure(figsize=(9, 6))
    plt.plot(RGB_history.history['loss'])
    plt.title('model loss')
    plt.ylabel('Loss', fontsize=12)
    plt.xlabel('Epoch', fontsize=12)
    plt.legend(['train RGB'], loc='upper right')
    plt.grid()
    plt.show()</code></p>
<p>//可视化<br>//数据的绘图过程就是将前面所得到的一系列数据，通过静态、动态的二维、三维图形进行展示<br>1.Matplotlib<br>//绘制y=sinx图像<br><code>import numpy as np
import matplotlib.pyplot as plt
x = np.linspace(0, 4*np.pi, 1000)
y = np.sin(x)
plt.plot(x,y)</code></p>
<p>//利用API,绘制更加审美要求的图像<br>`import numpy as np<br>import matplotlib.pyplot as plt<br>import matplotlib as mpl</p>
<h1 id="设置图片风格"><a href="#设置图片风格" class="headerlink" title="设置图片风格"></a>设置图片风格</h1><p>mpl.style.use(‘seaborn-darkgrid’)</p>
<h1 id="定义曲线"><a href="#定义曲线" class="headerlink" title="定义曲线"></a>定义曲线</h1><p>x = np.linspace(0, 4*np.pi, 100)<br>y1 = np.sin(x)<br>y2 = np.sin(x+1)<br>y3 = np.sin(x+2)</p>
<h1 id="绘图"><a href="#绘图" class="headerlink" title="绘图"></a>绘图</h1><p>plt.plot(x, y1, color=’#009900’, lw=6, alpha=0.6)<br>plt.plot(x, y2, color=’#990000’, lw=6, alpha=0.6)<br>plt.plot(x, y3, color=’#000099’, lw=6, alpha=0.6)</p>
<h1 id="展示"><a href="#展示" class="headerlink" title="展示"></a>展示</h1><p>plt.show()`</p>
<p>9.4ECharts<br>//ECharts提供了常规的折线图、柱状图、散点图、饼图、K线图等等，功能强大。<br>//ECharts图形绘制<br>略</p>
<p>//文本向量化<br>//文本向量化函数</p>
<h1 id="文本TfIdf向量化"><a href="#文本TfIdf向量化" class="headerlink" title="文本TfIdf向量化"></a>文本TfIdf向量化</h1><p><code>from sklearn.feature_extraction.text import TfidfVectorizer
vectorizer = TfidVectorizer()
vectors = vectorizer.fit_transform(datas)</code></p>
<p>//文本向量化的数据进行降维<br>//LDA降维<br><code>from sklearn.decomposition import LatentDirichletAllocation
lda = LatenDirichletAllocation(n_components=n_topic, max_iter=5,
    learning_method = 'online',
    learning_offset = 50.,
    radom_state = 0)</code></p>
<h1 id="用LDA方法降维数据"><a href="#用LDA方法降维数据" class="headerlink" title="用LDA方法降维数据"></a>用LDA方法降维数据</h1><p><code>dr_vectors = lad.fit_transform(vectors)</code></p>
<p>9.6三维可视化<br>//ECharts地图柱状图<br><code>myChart.setOption({
    visualMap: {
        show: flase,
        calculable: true,
        realtime: false,
        inRange: {
        color: ['#313695', '#4575b4', '#74add1', '#abd9e9',
                '#e0f3f8', '#ffffbf', '#fee090', '#fdae61',
                '#f46d43', '#d73027', '#d73027', 'a50026']
                },
        outOfRange: {
            colorAlpha: 0
            },
        max: linedata[1]
        },
        ...
        series: [{
            type: 'bar3D',
            shading: 'realistic',
            coordinateSystem: 'mapbox',
            barSize: 0.2,
            silent: true,
            data: linedata[0]
            }]
        });</code></p>
<p>//利用Matplotlib完成对三维数据的可视化任务<br><code>from mpl_toolkits.mplot3d import axes3d
import matplotlib.pyplot as plt
from matplotlib import cm
import matplotlib.style as style
style.use('seaborn-darkgrid')</code></p>
<h1 id="定义三维画布"><a href="#定义三维画布" class="headerlink" title="定义三维画布"></a>定义三维画布</h1><p><code>fig = plt.figure()
ax = fig.gca(projection='3d')</code></p>
<h1 id="获取数据-1"><a href="#获取数据-1" class="headerlink" title="获取数据"></a>获取数据</h1><p><code>X, Y, Z = axes3d.get_test_data(0.05)</code></p>
<h1 id="绘制surface"><a href="#绘制surface" class="headerlink" title="绘制surface"></a>绘制surface</h1><p><code>ax.plot_surface(X, Y, Z, rstride=8, cstride=8, alpha=0.3)</code></p>
<h1 id="绘制等值线"><a href="#绘制等值线" class="headerlink" title="绘制等值线"></a>绘制等值线</h1><p><code>cst = ax.contourf(X, Y, Z, zdir='z', offset=-100, cmap=cm.coolwarm)
cst = ax.contourf(X, Y, Z, zdir='x', offset=-40, cmap=cm.coolwarm)
cst = ax.contourf(X, Y, Z, zdir='y', offset=40, cmap=cm.coolwarm)</code></p>
<p><code>plt.show()</code></p>
<p>9.7动态可视化<br>//Matplotlib中用于数据动态演示的方法为animation,其可以通过函数进行简单的调用，以进行动态图形的演示工作<br>//动画展示<br><code>import matplotlib.animation as animation
animation.FuncAniamtion(
    ...
    )</code></p>
<p>//动态可视化的展示方式是在普通的图表之上通过不断地修改数据并进行展示，这种修改可以通过setOption而得到的，在实现上可以通过函数递归的方式实现动态数据的可视化工作<br><code>function update(){
    myChart.setOption(...);
        setTimeout(update, UPDATE_DURATION);
        }
update();</code></p>
<p>//优化实践<br>10.1通用深度神经网络训练优化建议</p>
<p>1）通用的较为优化的训练过程<br>1.将问题转换为相似的经典问题场景，参照paper中的配置和调优技巧进行最初的实验与优化<br>2.优化算法：选用随机梯度下降（SGD)算法，虽然批量梯度下降（BGD)相比SGD有一些优势，但是在处理大规模数据时，SGD及其优化变种更加简单和快速。<br>3.随机Shuffle样本：应尽量避免连续处理的样本属于同一类别的情况。尽量选择当前样本能让模型产生较大的误差，而不是较小的误差<br>4.规范化数据：输入的每个变量均值最好趋近于0.变换输入变量，使其协方差相近，变量间尽量不要相关<br>5.激活函数的选取：相比Sigmoid函数，tanh和Relu有更好的收敛速度。<br>6.权重初始化：可以随机通过一种分布，均值为0.<br>7.选择学习率：每个权重都可以选取属于自己的学习率。处于低层的权重学习率最好大于高层的权重学习率。学习率最好正比于每个单元的输入数量。</p>
<p>2）CNN训练过程中通常关注的优化点和参数<br>一般比较关注：Learning Rate,Weight Decay,Momentum,Batchsize,Init Weights,数据增强<br>eg:在Resnet中，使用SGD优化算法优化方法训练，mini-batch的大小设置为256，学习率初始化为0.1.随着训练进行，当Loss不再下降，会每次自适应以10倍进行缩减学习率。模型训练用了60x10^4轮迭代。Weight Decay设置为0.0001，同时设置momentum为0.9</p>
<p>3)RNN训练过程中通常关注的优化点和参数<br>一般比较关注：SGD,正则化，规范化梯度，Pad Sentence,Init Weight, Batch Size, Embedding输入，输出控制，Vacabulary Size, Sampled Softmax<br>eg:Google发布的TTS模型TACOTRON为例</p>
<p>10.1.1 过拟合和欠拟合<br>欠拟合：若训练集和测试集的误差有收敛但很高时，则为高偏差<br>过拟合：若训练集和测试集的误差较大时，则为高方差</p>
<p>解决过拟合的方法：<br>正则化，数据增强，Early Stop, Dropout, Batch Normalization</p>
<p>解决欠拟合的方法：<br>1.使用更加复杂的深度学习网络架构<br>2.添加其他特征项，有时候模型出现欠拟合的情况是因为特征项不够导致的，可以添加其他特征项来很好的解决这个问题<br>3.减少正则化参数和组件，正则化的目的是用来防止过拟合。</p>
<p>10.1.2数据增强<br>//数据增强的根本原因在于机器在学习的过程中会在模型中遇到大量的参数，同时为了防止过拟合<br>1）对于图像数据，可采取：<br>1.图像平移：使得网络学习到平移不变的特性<br>2.图像旋转：使得网络学习到旋转不变的特性<br>3.图像亮度变化<br>4.裁剪<br>5.缩放<br>6.图像模糊:用不同的卷积模板产生模糊图像<br>2）语音识别中对输入数据添加随机噪声等方式<br>3）NLP中最常用的方式就是进行近义词替换等方式<br>4）噪声注入，可以对输入添加噪声，也可以对隐藏层或者输出层添加噪声</p>
<p>10.1.3梯度消失<br>//实验数据显示了深度神经网络在训练过程中，随着epoch的增加各隐藏层的学习率变化。前面隐藏层的学习速度要低于后面的隐藏层<br>//梯度消失的原因：根据链式法则，如果每一层神经元对上一层输出的偏导乘上权重结果都小于1的话，那么即使这个结果是0.99，在经过足够多层的传播后，误差对输入层的偏导也会趋近于0<br>解决梯度消失的策略：<br>1.BN<br>2.RNN中使用LSTM:适用于RNN,门控制和长时记忆可缓解和解决梯度消失问题<br>3.激活函数Relu:新的激活函数解析性质更好，其在一定程度上克服了sigmoid函数和tanh函数的梯度消失问题。<br>4.在RNN反向传播过程中减少时间步长度。</p>
<p>10.1.4初始化权重<br>//在参数解空间内，好的权重初始化方式，意味着离全局最小值更近。<br>1.高斯初始化，为权重初始化较小的值，权重按照高斯分布随机进行初始化，固定均值和方差<br>2.Xaiver更新方法，使用tanh为激活函数，效果较好。进行梯度更新时，收敛速度较快，然而没有考虑Relu<br>3.MSRA方法，适用于从头训练深层深度神经网络的网络结构。权重以高斯分布随机进行初始化，方差需要考虑空间过滤器的大小和过滤器数量的影响。</p>
<p>10.1.5优化算法<br>近些年最常用的是采用Adam优化算法，也可以采用自适应学习率的方法实现快速收敛。</p>
<p>10.1.6超参数选择<br>一些实践经验：<br>1.在验证集上进行调参<br>2.优先调Learning Rate<br>3.通过初期设计卷积层尽量深、卷积核尽量多的模型，强行让模型拟合训练集，这时会出现过拟合，之后通过Dropout、正则化和Data Augument等等方式去改善模型结果<br>4.调整模型的层数和卷积核数量</p>
<p>//通过Scikit-learn的网格搜索库进行参数调优实例<br>1.常见搜索参数<br>学习率、Dropout、Epochs和神经元数量<br>2.数据集下载<br>数据集为Pima Indians Onset of Diabetes分类数据集<br>下载地址：<a target="_blank" rel="external nofollow noopener noreferrer" href="https://archive.ics.uci.edu/ml/machine-learning-databases/pima-indians-diabetes/">https://archive.ics.uci.edu/ml/machine-learning-databases/pima-indians-diabetes/</a><br>3.搜索最优batchsize和epochs<br>//以20的步长，从10到100逐步评估不同的微型批尺寸，epochs分别设置为10、50、100<br><code>import numpy
from sklearn.grida_search import GridSearchCV
from keras.models import Sequential
from keras.layers import Dense
from keras.wrappers.scikit_learn import KerasClassifier</code></p>
<h1 id="Function-to-create-model-required-for-KerasClassifier"><a href="#Function-to-create-model-required-for-KerasClassifier" class="headerlink" title="Function to create model, required for KerasClassifier"></a>Function to create model, required for KerasClassifier</h1><p>`def create_model():</p>
<pre><code>#create model
model = Sequential()
model.add(Dense(12, input_dim=8, activation='relu'))
model.add(Dense(1, activation='sigmoid'))`


#compile model
model.compile(loss='binary_crossentropy', optimizer='adam', metrics=['accuracy'])
return model
</code></pre><p>`#fix random seed for reproducibility<br>seed = 7<br>numpy.random.seed(seed)</p>
<h1 id="load-dataset"><a href="#load-dataset" class="headerlink" title="load dataset"></a>load dataset</h1><p>dataset = numpy.loadtxt(“pima-indians-diabetes.csv”, delimiter=’,’)</p>
<h1 id="split-into-input-x-and-output-Y-variables"><a href="#split-into-input-x-and-output-Y-variables" class="headerlink" title="split into input (x) and output (Y) variables"></a>split into input (x) and output (Y) variables</h1><p>X = [:, 0:8]<br>Y = [:, 8]</p>
<h1 id="create-model"><a href="#create-model" class="headerlink" title="create model"></a>create model</h1><p>model = KerasClassifier(build_fn=create_model, verbose=0)</p>
<h1 id="define-the-grid-search-parameters"><a href="#define-the-grid-search-parameters" class="headerlink" title="define the grid search parameters"></a>define the grid search parameters</h1><p>batch_size = [10, 20, 40, 60, 80, 100]<br>epochs = [10, 50, 100]<br>param_grid = dict(batch_size=batch_size, nb_epoch=epochs)<br>grid = GridSearchCV(estimator=model, param_grid=parm_grid, n_jobs=-1)<br>grid_result = grid_fit(X,Y)</p>
<h1 id="summarize-results"><a href="#summarize-results" class="headerlink" title="summarize results"></a>summarize results</h1><p>print(“Best: %f using %s” % (grid<em>result.best_score</em>, grid<em>result.best_params))<br>for params, mean_score, scores in grid_result.grid_scores</em>:<br>    print(“%f (%f) with: %r” % (scores.mean(), scores.std(), params))`</p>
<p>10.2深度学习系统性能优化建议<br>10.2.1输入及预处理流水线优化<br>输入流水线：从磁盘读取图像，将JPEG预处理为张量，进行数据预处理裁剪、翻转等，然后进行批处理操作<br>1.在CPU端进行预处理<br>//在CPU端上放置输入预处理操作可以显著提高性能，GPU专注训练<br>//控制代码在CPU端执行<br>`with tf.device(“/cpu:0”):</p>
<pre><code># function to get and process data.
</code></pre><p>​    distored_inputs = load_and_preprocess_images()`</p>
<p>2.使用大文件<br>读取大量的小文件会显著影响I/O性能<br>1）转换为TFRecord格式<br>2）小数据集加载到内存</p>
<p>10.2.2数据格式<br>NHWC的方存局部性更好（每三个输入像素即可得到一个输出像素），NCHW则必须等所有通道输入都准备好后才能得到最终的输出结果，需要占用较大的临时空间。<br>tf默认NHWC格式，Nvidia cuDNN默认NCHW格式<br>注：设计网络时充分考虑这两种格式，最好能够灵活切换，在GPU上训练时使用NCHW格式，在CPU上做预测时使用NHWC格式</p>
<p>10.2.3编译优化<br>//通过bazel命令对特定平台对tf进行编译<br><code>bazel build -c opt --copt=-march="brodewell" --config=cuda
//tensorflow/tools/pip_package:build_pip_package</code></p>
<p>10.2.4GPU性能瓶颈诊断<br>//参考如下分析步骤对作业进行优化<br>1）对代码进行性能分析<br>2）找到运行慢的阶段<br>3）分析慢的原因<br>4）修改成更快的实现<br>5）再次对代码进行性能分析</p>
<p>//处理器有两个关键的性能瓶颈：浮点计算量和内存吞吐量。<br>//可通过以下工具进行深度学习作业的性能分析<br>1.Tensorflow性能分析工具Timeline(获取执行图中每个节点的执行时间）<br>1）创建metadata运行时对象<br>2）获取运行时信息创建Timeline对象<br>3）将Timeline对象写入json文件<br>4）Chrome加载trace的json文件</p>
<p>//tensorflow使用Timeline进行性能分析<br><code>import tensorflow as tf
from tensorflow.python.client import timeline</code></p>
<p><code>x = tf.random_normal([1000, 1000])
y = tf.random_normal([1000, 1000])
res = tf.matmul(x, y)</code></p>
<p><code>#run the graph with full trace option
with tf.Session() as sess:
    run_options = tf.RunOptions(trace_level=tf.RunOptions.FULL_TRACE)
    run_metadata = tf.RunMetadata()
    sess.run(res, options=run_options, run_metadata=run_metadata)</code></p>
<pre><code>#create Timeline variable，then write it into json file
t1 = timeline.Timeline(run_metadata.step_stats)
ctf = t1.generate_chrome_trace_format()
with open('timeline.json', 'w') as f:
    f.write(ctf)
</code></pre><p>可以打开谷歌chrome浏览器，转到chrome://tracing页并加载timeline.json文件，接下来，可以进行程序的profiling</p>
<p>2.常用的GPU分析工具<br>1）nvprof是英伟达性能分析工具<br>2）nvvp则是带GUI的英伟达可视化性能分析工具</p>
<p>10.2.5CPU瓶颈优化<br>1）多线程方式优化<br>以下两个针对tensorflow的配置可以通过适配线程池进行CPU的性能优化<br>intra_op_parallelism_threads：对tf操作符内部的任务进行并行化<br>inter_op_parallelism_threads: 控制多个运算符之间的并行化运算<br>//多线程优化<br><code>config = tf.ConfigProto()
config.intra_op_parallelism_threads = 22
config.inter_op_parallelism_threads = 22
tf.session(config=config)</code></p>
<p>2)使用SIMD高级指令集<br>参考tf官方文档的”Performance Guide”章节</p>
<p>10.2.6模型压缩<br>模型小型化：从模型权重的角度进行压缩和从网络架构的角度进行压缩<br>网络架构角度：提出新的网络结构或卷积方法进行压缩优化，如SqueezeNet, MobileNets等<br>模型权重角度：一般是在已经训练好的模型上进行裁剪，然后fine-tuning到原有模型的准确率，一般的优化方式包括剪枝、权值共享、神经网络二值化等。</p>
<p>10.3工程实践建议<br>10.3.1Model格式转换<br>框架间的模型转换<br>参考链接：<br>1.<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/ysh329/deep-learning-model-convertor">https://github.com/ysh329/deep-learning-model-convertor</a><br>2.<a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Microsoft/MMdnn">https://github.com/Microsoft/MMdnn</a></p>
<p>10.3.2迁移学习（Transfer Learning)<br>其思想是将训练好的模型参数迁移到新的模型来帮助新模型的训练和预测。</p>
<p>//通过MNIST数据集0~4的数字训练一个模型，然后将模型迁移到5~9数据集上进行迁移学习<br>1）在MNIST数据集上训练一个简单的卷积神经网络，只预测0~4的数字<br>2）将训练好的预测0~4数据集的模型，应用到5~9数据集上。对模型冻结卷积层参数，Fine-Tuning全连接层。<br>//keras迁移学习实例<br><code>from __future__ import print_function
import datetime
import keras
from keras.datasets import mnist
from keras.models import Sequential
from keras.layers import Dense, Dropout, Activation, Flatten
from keras.layers import Conv2D, MaxPooling2D
from keras import backend as K</code></p>
<p><code>now = datetime.datetime.now
batch_size = 128
num_classes = 5
epochs = 5</code></p>
<p>`#input images dimensions<br>img_rows, img_cols = 28, 28</p>
<h1 id="number-of-convolutional-filters-to-use"><a href="#number-of-convolutional-filters-to-use" class="headerlink" title="number of convolutional filters  to use"></a>number of convolutional filters  to use</h1><p>filters = 32</p>
<h1 id="size-of-pooling-area-for-max-pooling"><a href="#size-of-pooling-area-for-max-pooling" class="headerlink" title="size of pooling area for max pooling"></a>size of pooling area for max pooling</h1><p>pool_size = 2</p>
<h1 id="convolution-kernel-size"><a href="#convolution-kernel-size" class="headerlink" title="convolution kernel size"></a>convolution kernel size</h1><p>kernel_size = 3`</p>
<p><code>if K.image_data_format()=='channels_first':
    input_shape = (1, img_rows, img_cols)
else:
    input_shape = (img_rows, img_cols, 1)</code></p>
<p><code>def train_model(model, train, test, num_classes):
    x_train = train[0].reshape((train[0].shape[0],)+input_shape)
    x_test = test[0].reshape((test[0].shape[0],)+input_shape)
    x_train = x_train.astype('float32')
    x_test = x_test.astype('float32')
    x_train /= 255
    x_test /= 255
    print('x_train shape:', x_train.shape)
    print(x_train.shape[0], 'train samples')
    print(x_test.shape[0], 'test samples')</code></p>
<pre><code>#convert class vectors to binary class matrics
y_train = keras.utils.to_categorical(train[1], num_classes)
y_test = keras.utils.to_categorical(test[1], num_classes)

model.compile(
    loss = 'categorical_crossentropy',
    optimizer = 'adadelta',
    metrics = ['accuracy']
    )

t = now()
model.fit(x_train, y_train,
    batch_size = batch_size,
    epochs = epochs,
    verbose = 1,
    validation_data = (x_test, y_test))
print('Training time: %s' %(now() -t))
score = model.evaluate(x_test, y_test, verbose=0)
print('Test score:', score[0])
</code></pre><p>`#the data,shuffled and spilt between train and test sets<br>(x_train, y_train), (x_test, y_test) = mnist.load-data()</p>
<h1 id="create-two-datasets-one-with-digits-below-5-and-one-with-5-and-above"><a href="#create-two-datasets-one-with-digits-below-5-and-one-with-5-and-above" class="headerlink" title="create two datasets one with digits below 5 and one with 5 and above"></a>create two datasets one with digits below 5 and one with 5 and above</h1><p>x_train_lt5 = x_train[y_train&lt;5]<br>y_train_lt5 = x_train[y_train&lt;5]<br>x_test_lt5 = x_test[y_test&lt;5]<br>y_test_lt5 = y_test[y_test&lt;5]`</p>
<p><code>x_train_get5 = x_train[y_train&gt;=5]
y_train_get5 = y_train[y_train&gt;=5]-5
x_test_get5 = x_test[y_test&gt;=5]
y_test_get5 = y_test[y_test&gt;=5]-5</code></p>
<p><code>#define two groups of layers:feature(convolutions) and classification(dense)
feature_layers = [
        Conv2D(filters, kernel_size,
            padding='valid',
            input_shape=input_shape),
        Activation('relu'),
        Conv2D(filters, kernel_size),
        Activation('relu'),
        MaxPooling2D(pool_size=pool_size),
        Dropout(0.5),
        Flatten()]
classification_layers=[
    Dense(128),
    Activation('relu'),
    Dropout(0.5),
    Dense(num_classes),
    Activation('softmax')]</code></p>
<p><code>#create complete model
model = Sequential(feature_layers+classification_layers)</code></p>
<p><code>#train model for 5-digit classification(0~4)
train_model(model,
    (x_train_lt5, y_train_lt5),
    (x_test_lt5, y_test_lt5), num_classes)</code></p>
<p><code>#freeze feature layers and rebuild model
for l in feature_layers:
    l.trainable = False</code></p>
<p><code>#transfer: train dense layers for new classification task(5~9)
train_model(model,
    (x_train_gte5, y_train_get5),
    (x_test_get5, y_test_get5), num_classes)</code></p>
<p>​<br>​<br>​    </p>

  </div>
  
  
    
    <div class="footer">
       <!-- 参考资料、相关资料等 -->
      
       <!-- 相关文章 -->
      
      <!-- 版权声明组件 -->
      
      <!-- 打赏组件 -->
      
        <div class="donate">
        <iframe src="https://pistachio0812.github.io/donate/drinks" style="overflow-x:hidden;overflow-y:hidden; border:0xp none #fff; min-height:240px; width:100%;" frameborder="0" scrolling="no"></iframe>
        </div>
      
    </div>
  
  
    


  <div class="article-meta" id="bottom">
    <div class="new-meta-box">
      
        
          <div class="new-meta-item date" itemprop="dateModified" datetime="2022-10-04T21:51:36+08:00">
  <a class="notlink">
    <i class="fa-solid fa-edit fa-fw" aria-hidden="true"></i>
    <p>更新于：2022年10月4日</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="nofollow"><i class="fa-solid fa-hashtag fa-fw" aria-hidden="true"></i><p>学习笔记</p></a></div>
  <span hidden itemprop="keywords">学习笔记</span>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title rel="external nofollow noopener noreferrer" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://pistachio0812.github.io/zh-CN/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=tensorflow学习笔记 - 阿月浑子-Hexo博客&summary=">
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qq.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qq.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title rel="external nofollow noopener noreferrer" target="_blank" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://pistachio0812.github.io/zh-CN/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=tensorflow学习笔记 - 阿月浑子-Hexo博客&summary=">
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qzone.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/qzone.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title rel="external nofollow noopener noreferrer" target="_blank" href="http://service.weibo.com/share/share.php?url=http://pistachio0812.github.io/zh-CN/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/&title=tensorflow学习笔记 - 阿月浑子-Hexo博客&summary=">
          
            <img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/weibo.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/weibo.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
          
        </a>
      
    
      
        
        <div class="hoverbox">
          <a class="share"><img src="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/wechat.png" class="lazyload" data-srcset="https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/logo/128/wechat.png" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></a>
          <div class="target">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAATgAAAE4CAAAAADqFLC2AAADpElEQVR42u3awW7rMAwEwPz/T793LxBYXNI1a4xuQVxHHPWwIPX5Z0XrgwAcOHDgLHDglsB9wvXz76/ed7mhi+evfqf6nrhecODAgQMHDhy4ZXDHAbAIUQVKnzv9vlsvOHDgwIEDBw7cVrhq4D0NpNXgWg2mXcjj/YMDBw4cOHDgwL0Ebgo2bYCmBwQOHDhw4MCBAwcuK7w6eJ4O2uDAgQMHDhw4cG+DuytoTgfm7oXExyf54MCBAwcOHDhwQ3DpIPivfo7rBQcOHDhw4MCBWwLXXd3G5dSFwNPGZLtecODAgQMHDhy4JXDdDZ8G5O6FxPS5NOi2O8DgwIEDBw4cOHA3w6WD2m5gTr/vHmA6yAYHDhw4cODAgdsO173olxZcbZSmFwrTIA4OHDhw4MCBA7cNLh3spkH2boi7DxQcOHDgwIEDB24r3NTA+fT9dwXm6nuO6wUHDhw4cODAgVsKN7Xh6YuD6e+lDdqv7wUHDhw4cODAgVsOl17k6xY+FaS7z8cDaXDgwIEDBw4cuIfg7gqu3cBa3Vf1INsXC8GBAwcOHDhw4B6CSzc0PbiuBuX0wOM6wIEDBw4cOHDglsClqxpop4Nquq/TBubXfYMDBw4cOHDgwC2Dmxr0phudanhW33MKDA4cOHDgwIEDtw3utPF4GnDTYFxtWHYbo/GBgAMHDhw4cODALYPrfu4G1+mBdTV4j18sBAcOHDhw4MCBexiuuqEp2OmBeLUucODAgQMHDhy47XDdQW51YD0VXKvvnxqsgwMHDhw4cODAbYGrDoLT4LjlAiE4cODAgQMHDtxb4NKNVn/wFLI7qJ5quH59Dhw4cODAgQMHbglcHASbgbUatKuFpr9fnuSDAwcOHDhw4MA9BFdtNFY3Vr1IeFxAceCcNljBgQMHDhw4cOD+Gly1MZgG1mrDcqwhWawLHDhw4MCBAwduG9wnXGmQTRuS1WA93fAEBw4cOHDgwIHbBtddcZC86QDShufxZ3DgwIEDBw4cuCVw0wF0KnjeBVptoN7eyAQHDhw4cODAgWvC/daAutqQTKHTC4iXz4MDBw4cOHDgwC2F6xaYFn4cQJsBuj3gBgcOHDhw4MCBewlctaDfOpjb/iHAgQMHDhw4cOBeDtdd3QF39f3HjU9w4MCBAwcOHLilcOlAutp4nG4wVvcdHyA4cODAgQMHDtwyuDSgpoPk0yA6tZ+xRis4cODAgQMHDtwSOKu2wIEDBw6cBQ7cw+s/efCFTMwnfVYAAAAASUVORK5CYII=">
          </div>
        </div>
      
    
      
    
  </div>
</div>



        
      
    </div>
    <!-- Custom Files bottomMeta begin -->
    
    <!-- Custom Files bottomMeta end -->
  </div>


  
  

  
    <div class="prev-next">
      
        <a class="prev" href="/zh-CN/%E5%AD%A6%E4%B9%A0%E7%BD%91%E7%AB%99%E9%9B%86%E5%90%88/">
          <p class="title"><i class="fa-solid fa-chevron-left" aria-hidden="true"></i>学习网站集合</p>
          <p class="content">万门好课万门好课是一家提供多品类原创精品课程的在线教育平台 ，课程覆盖IT与互联网类、职业成长类、经济金融类、本科学习类等领域 。 整体课程定位侧重于“用户刚需”类课程，如语言版块的出国英语考试...</p>
        </a>
      
      
        <a class="next" href="/zh-CN/%E6%96%87%E7%8C%AE%E9%98%85%E8%AF%BB%E5%90%88%E9%9B%86/">
          <p class="title">CV必备文献<i class="fa-solid fa-chevron-right" aria-hidden="true"></i></p>
          <p class="content">这里是我平时会看的一些文献，有些没得时间看，但这些确实很值得一看，放在这里，做个提醒，如果后续我记起来了，后续还会有补充，大家可以留言推荐，仅限计算机视觉方向
1.RFBNet
论文标题：Rec...</p>
        </a>
      
    </div>
  
  <!-- Custom Files postEnd begin-->
  
  <!-- Custom Files postEnd end-->
</article>


  


  <article class="post white-box shadow" id="comments">
    <span hidden>
      <meta itemprop="discussionUrl" content="/zh-CN/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html#comments">
    </span>
    <p ct><i class="fa-solid fa-comments"></i> 评论</p>
    

    <div id="layoutHelper-comments"></div>

  </article>






</div>
<aside id="l_side" itemscope itemtype="http://schema.org/WPSideBar">
  

  
    
    
      
    
  


<div class="widget-sticky pjax">

  
  


  <section class="widget toc-wrapper desktop mobile " id="toc-div">
    
  <header>
    
      <i class="fa-solid fa-list fa-fw" aria-hidden="true"></i><span class="name">本文目录</span>
    
  </header>


    <div class="content">
        
    </div>
  </section>

  

</div>


<!-- 没有 pjax 占位会报错 万恶的 pjax -->

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <div class="pjax">
    <!-- pjax占位 -->
  </div>

  <!-- Custom Files side begin -->
  
  <!-- Custom Files side end -->
</aside>



          <!--此文件用来存放一些不方便取值的变量-->
<!--思路大概是将值藏到重加载的区域内-->

<pjax>
<script>
  window.pdata={}
  pdata.ispage=true;
  pdata.commentPath="";
  pdata.commentPlaceholder="";
  pdata.commentConfig={};
  //  see: /layout/_partial/scripts/_ctrl/coverCtrl.ejs
  
    // header
    var l_header=document.getElementById("l_header");
    
    l_header.classList.add("show");
    
    
      // cover
      var cover_wrapper=document.querySelector('#l_cover .cover-wrapper');
      var scroll_down=document.getElementById('scroll-down');
      cover_wrapper.id="none";
      cover_wrapper.style.display="none";
      scroll_down.style.display="none";
    
  
</script>
</pjax>
        </div>
        
  
  <footer class="footer clearfix" itemscope itemtype="http://schema.org/WPFooter">
    <br><br>
    
      
        <div class="aplayer-container">
          

  
    <meting-js theme="#1BCDFC" autoplay="false" volume="0.7" loop="all" order="list" fixed="false" list-max-height="320px" server="tencent" type="playlist" id="2185397204" list-folded="true">
    </meting-js>
  


        </div>
      
    
      
        <br>
        <div class="social-wrapper" itemprop="about" itemscope itemtype="http://schema.org/Thing">
          
            
              <a href="/atom.xml" class="social fas fa-rss flat-btn" target="_blank" rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
            
              <a href="mailto:2395856915@qq.com" class="social fas fa-envelope flat-btn" target="_blank" rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
            
              <a href="https://github.com/pistachio0812" class="social fab fa-github flat-btn" target="_blank" rel="external nofollow noopener noreferrer" itemprop="url">
                
              </a>
            
          
            
          
            
          
        </div>
      
    
      
        <div><p>博客内容遵循 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
      
    
      
        本站使用
        <a href="https://github.com/volantis-x/hexo-theme-volantis/#4.2.0" target="_blank" class="codename" rel="external nofollow noopener noreferrer">Volantis</a>
        作为主题
      
    
      
        <div class="copyright">
        <p><a href="/">Copyright ©2020-2023江西理工大学.All Rights Reserved</a></p>

        </div>
      
    
    <!-- Custom Files footer begin-->
    
    <!-- Custom Files footer end-->
  </footer>


        <a id="s-top" class="fa-solid fa-arrow-up fa-fw" href="/" onclick="return false;" title="top"></a>
      </div>
    </div>
    <div>
      <script>
  /******************** volantis.dom ********************************/
  // 页面选择器 将dom对象缓存起来 see: /source/js/app.js etc.
  volantis.dom.bodyAnchor = volantis.dom.$(document.getElementById("safearea")); // 页面主体
  volantis.dom.topBtn = volantis.dom.$(document.getElementById('s-top')); // 向上
  volantis.dom.wrapper = volantis.dom.$(document.getElementById('wrapper')); // 整个导航栏
  volantis.dom.coverAnchor = volantis.dom.$(document.querySelector('#l_cover .cover-wrapper')); // 1个
  volantis.dom.switcher = volantis.dom.$(document.querySelector('#l_header .switcher .s-search')); // 搜索按钮   移动端 1个
  volantis.dom.header = volantis.dom.$(document.getElementById('l_header')); // 移动端导航栏
  volantis.dom.search = volantis.dom.$(document.querySelector('#l_header .m_search')); // 搜索框 桌面端 移动端 1个
  volantis.dom.mPhoneList = volantis.dom.$(document.querySelectorAll('#l_header .m-phone .list-v')); //  手机端 子菜单 多个
</script>

<script>
  
  volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/@fortawesome/fontawesome-free/css/all.min.css");
  
  
  volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/font-awesome-animation/font-awesome-animation.min.css");
  
  
  volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/node-waves/dist/waves.min.css");
  
</script>

<!-- required -->


<!-- internal -->

<script src="/js/app.js"></script>





  













<div id="rightmenu-wrapper">
  <ul class="list-v rightmenu" id="rightmenu-content">
    
  <li class="navigation menuNavigation-Content">


    <a class="nav icon-only fix-cursor-default" onclick="history.back()"><i class="fa-solid fa-arrow-left fa-fw"></i></a>



    <a class="nav icon-only fix-cursor-default" onclick="history.forward()"><i class="fa-solid fa-arrow-right fa-fw"></i></a>



    <a class="nav icon-only fix-cursor-default" onclick="window.location.reload()"><i class="fa-solid fa-redo fa-fw"></i></a>



    <a class="nav icon-only fix-cursor-default" onclick="VolantisApp.scrolltoElement(volantis.dom.bodyAnchor)"><i class="fa-solid fa-arrow-up fa-fw"></i></a>


  </li>


    <hr class="menuLoad-Content">



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="prev" data-event="volantis.rightmenu.jump('prev')" data-group="prevNext">
      <i class="fa-solid fa-angles-left fa-fw"></i>
      查看上一篇
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="next" data-event="volantis.rightmenu.jump('next')" data-group="prevNext">
      <i class="fa-solid fa-angles-right fa-fw"></i>
      查看下一篇
    </span>
  </li>



    <hr class="menuLoad-Content">



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyPaste" data-event="copyPaste" data-group="inputBox">
      <i class="fa-solid fa-paste fa-fw"></i>
      粘贴文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyAll" data-event="copyAll" data-group="inputBox">
      <i class="fa-solid fa-object-ungroup fa-fw"></i>
      全选文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyCut" data-event="copyCut" data-group="inputBox">
      <i class="fa-solid fa-cut fa-fw"></i>
      剪切文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyText" data-event="copyText" data-group="seletctText">
      <i class="fa-solid fa-copy fa-fw"></i>
      复制文本
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="searchWord" data-event="OpenSearch(__text__)" data-group="seletctText">
      <i class="fa-solid fa-search fa-fw"></i>
      站内搜索
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="bingSearch" data-event="window.open(`https://cn.bing.com/search?q=${__text__}`)" data-group="seletctText">
      <i class="fa-solid fa-search fa-fw"></i>
      必应搜索
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="openTab" data-event="window.open(__link__)" data-group="elementCheck">
      <i class="fa-solid fa-external-link-square-alt fa-fw"></i>
      新标签页打开
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyLink" data-event="copyLink" data-group="elementCheck">
      <i class="fa-solid fa-link fa-fw"></i>
      复制链接地址
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="copyImg" data-event="copyImg" data-group="elementImage">
      <i class="fa-solid fa-image fa-fw"></i>
      复制图片
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="googleImg" data-event="window.open(`https://www.google.com.hk/searchbyimage?image_url=${__link__}`)" data-group="elementImage">
      <i class="fa-solid fa-images fa-fw"></i>
      谷歌识图
    </span>
  </li>



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="help" target="_blank" rel="external nofollow noopener noreferrer" href="https://volantis.js.org/faqs/" data-group="link">
      <i class="fa-solid fa-question fa-fw"></i>
      常见问题
    </a>
  </li>



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="examples" target="_blank" rel="external nofollow noopener noreferrer" href="https://volantis.js.org/examples/" data-group="link">
      <i class="fa-solid fa-rss fa-fw"></i>
      示例博客
    </a>
  </li>



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="contributors" target="_blank" rel="external nofollow noopener noreferrer" href="https://volantis.js.org/contributors/" data-group="link">
      <i class="fa-solid fa-fan fa-fw"></i>
      加入社区
    </a>
  </li>



    <hr class="menuLoad-Content">



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="source_docs" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/volantis-docs/" data-group="link">
      <i class="fa-solid fa-code-branch fa-fw"></i>
      本站源码
    </a>
  </li>



  <li class="menuLoad-Content">
    <a class="vlts-menu fix-cursor-default" id="source_theme" target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/volantis-x/hexo-theme-volantis/" data-group="link">
      <i class="fa-solid fa-code-branch fa-fw"></i>
      主题源码
    </a>
  </li>



    <hr class="menuLoad-Content">



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="darkMode" data-event="volantis.dark.toggle()" data-group="darkMode">
      <i class="fa-solid fa-moon fa-fw"></i>
      暗黑模式
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="printMode" data-event="printMode" data-group="articlePage">
      <i class="fa-solid fa-print fa-fw"></i>
      打印页面
    </span>
  </li>



  <li class="menuLoad-Content">
    <span class="vlts-menu fix-cursor-default event" id="readMode" data-event="readMode" data-group="articlePage">
      <i class="fa-solid fa-book-open fa-fw"></i>
      阅读模式
    </span>
  </li>


<div id="menuMusic">
  <li class="music name menuOption-Content">
    <p class="nav music-title fix-cursor-default"></p>
  </li>
  <li class="music ctrl">
    <a class="nav icon-only backward fix-cursor-default" href="/" onclick="return false;" title="backward">
      <i class="fa-solid fa-step-backward fa-fw"></i>
    </a>
    <a class="nav icon-only toggle fix-cursor-default" href="/" onclick="return false;" title="toggle">
      <i class="fa-solid fa-play fa-fw"></i>
    </a>
    <a class="nav icon-only forward fix-cursor-default" href="/" onclick="return false;" title="forward">
      <i class="fa-solid fa-step-forward fa-fw"></i>
    </a>
  </li>
  <li class="music volume">
    <div class="nav volume">
      <div class="aplayer-volume-bar-wrap">
        <div class="aplayer-volume-bar fix-cursor-pointer">
          <div class="aplayer-volume"></div>
          <i class="left fa-solid fa-volume-off fa-fw"></i>
          <i class="right fa-solid fa-volume-up fa-fw"></i>
        </div>
      </div>
    </div>
  </li>
</div>

  </ul>
</div>
<script src="/js/plugins/rightMenus.js"></script>
<script>
  const RightMenusFunction = {};
  












  RightMenusFunction['prev'] = () => {volantis.rightmenu.jump('prev')}





  RightMenusFunction['next'] = () => {volantis.rightmenu.jump('next')}







  //RightMenusFunction['copyPaste'] = (fun) => {fun()}





  //RightMenusFunction['copyAll'] = (fun) => {fun()}





  //RightMenusFunction['copyCut'] = (fun) => {fun()}





  //RightMenusFunction['copyText'] = (fun) => {fun()}





  RightMenusFunction['searchWord'] = (__text__) => {OpenSearch(__text__)}





  RightMenusFunction['bingSearch'] = (__text__) => {window.open(`https://cn.bing.com/search?q=${__text__}`)}





  RightMenusFunction['openTab'] = (__link__) => {window.open(__link__)}





  //RightMenusFunction['copyLink'] = (fun) => {fun()}





  //RightMenusFunction['copyImg'] = (fun) => {fun()}





  RightMenusFunction['googleImg'] = (__link__) => {window.open(`https://www.google.com.hk/searchbyimage?image_url=${__link__}`)}



















  RightMenusFunction['darkMode'] = () => {volantis.dark.toggle()}





  //RightMenusFunction['printMode'] = (fun) => {fun()}





  //RightMenusFunction['readMode'] = (fun) => {fun()}





</script>



<!-- rightmenu要在darkmode之前（ToggleButton） darkmode要在comments之前（volantis.dark.push）-->

  <script>
const rootElement = document.documentElement;
const darkModeStorageKey = "color-scheme";
const rootElementDarkModeAttributeName = "color-scheme";
const setLS = (k, v) => {
    localStorage.setItem(k, v);
};
const removeLS = (k) => {
    localStorage.removeItem(k);
};
const getLS = (k) => {
    return localStorage.getItem(k);
};
const getModeFromCSSMediaQuery = () => {
  return window.matchMedia("(prefers-color-scheme: dark)").matches
    ? "dark"
    : "light";
};
const resetRootDarkModeAttributeAndLS = () => {
  rootElement.removeAttribute(rootElementDarkModeAttributeName);
  removeLS(darkModeStorageKey);
};
const validColorModeKeys = {
  dark: true,
  light: true,
};
const applyCustomDarkModeSettings = (mode) => {
  const currentSetting = mode || getLS(darkModeStorageKey);
  getCustomDarkMode();
  if (currentSetting === getModeFromCSSMediaQuery()) {
    resetRootDarkModeAttributeAndLS();
  } else if (validColorModeKeys[currentSetting]) {
    rootElement.setAttribute(rootElementDarkModeAttributeName, currentSetting);
  } else {
    resetRootDarkModeAttributeAndLS();
  }
};
const invertDarkModeObj = {
  dark: "light",
  light: "dark",
};
/**
 * get target mode
 */
 const getCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);
  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  if(currentSetting=="dark"){
    volantis.dark.mode="light";
  }else{
    volantis.dark.mode="dark";
  }
  // console.log(volantis.dark.mode)
};
const toggleCustomDarkMode = () => {
  let currentSetting = getLS(darkModeStorageKey);
  if (validColorModeKeys[currentSetting]) {
    currentSetting = invertDarkModeObj[currentSetting];
  } else if (currentSetting === null) {
    currentSetting = invertDarkModeObj[getModeFromCSSMediaQuery()];
  } else {
    return;
  }
  setLS(darkModeStorageKey, currentSetting);
  return currentSetting;
};
/**
 * 暗黑模式触发器
 */
volantis.dark.toggle=()=>{
  const mode = toggleCustomDarkMode();
  applyCustomDarkModeSettings(mode);
  // 使用 volantis.dark.push 方法传入volantis.dark.toggle回调函数 参见layout/_partial/scripts/global.ejs
  volantis.dark.method.toggle.start();
}
/**
 * bind event for toggle button
 */

function bindToggleButton() {
  var btn= document.querySelectorAll("#wrapper .toggle-mode-btn,#rightmenu-wrapper .toggle-mode-btn")
  btn.forEach(function (e) {
    volantis.dom.$(e).on('click',volantis.dark.toggle);
  })
}
applyCustomDarkModeSettings();
document.addEventListener("DOMContentLoaded", ()=>{
  volantis.requestAnimationFrame(bindToggleButton)
});
volantis.pjax.push(bindToggleButton);

const darkModelListeners={
  dark:(mediaQueryList )=>{
    if(mediaQueryList.matches){
      volantis.dark.mode = "dark";
    }
    volantis.dark.method.toggle.start();
  },
  light:(mediaQueryList)=>{
    if(mediaQueryList.matches){
      volantis.dark.mode = "light";
    }
    volantis.dark.method.toggle.start();
  }
}
window.matchMedia('(prefers-color-scheme: dark)').addListener(darkModelListeners.dark)
window.matchMedia('(prefers-color-scheme: light)').addListener(darkModelListeners.light)
</script>




<script>
  function loadIssuesJS() {
    
      const sites_api = document.getElementById('sites-api');
      if (sites_api != undefined && typeof SitesJS === 'undefined') {
        volantis.js("/js/plugins/tags/sites.js")
      }
    
    
      const friends_api = document.getElementById('friends-api');
      if (friends_api != undefined && typeof FriendsJS === 'undefined') {
        volantis.js("/js/plugins/tags/friends.js")
      }
    
    
      const contributors_api = document.getElementById('contributors-api');
      if (contributors_api != undefined && typeof ContributorsJS === 'undefined') {
        volantis.js("/js/plugins/tags/contributors.js")
      }
    
  };
  loadIssuesJS()
  volantis.pjax.push(()=>{
    loadIssuesJS();
  })

</script>




  <script defer src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/vanilla-lazyload/dist/lazyload.min.js"></script>
<script>
  // https://www.npmjs.com/package/vanilla-lazyload
  // Set the options globally
  // to make LazyLoad self-initialize
  window.lazyLoadOptions = {
    elements_selector: ".lazyload",
    threshold: 0
  };
  // Listen to the initialization event
  // and get the instance of LazyLoad
  window.addEventListener(
    "LazyLoad::Initialized",
    function (event) {
      window.lazyLoadInstance = event.detail.instance;
    },
    false
  );
  document.addEventListener('DOMContentLoaded', function () {
    lazyLoadInstance.update();
  });
  document.addEventListener('pjax:complete', function () {
    lazyLoadInstance.update();
  });
</script>




  

<script>
  window.FPConfig = {
	delay: 0,
	ignoreKeywords: ["#"],
	maxRPS: 6,
	hoverDelay: 0
  };
</script>
<script defer src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/flying-pages/flying-pages.min.js"></script>







  <script>
  volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/aplayer/dist/APlayer.min.css");
  (async () => {
    // APlayer 需要在  MetingJS 之前加载
    await volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/aplayer/dist/APlayer.min.js")
    await volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/meting/dist/Meting.min.js")
  
    // 右键 music 需要在 APlayer  MetingJS 之后加载
    await volantis.js('/js/plugins/aplayer.js')
  
  })();

  function SetAPlayerPlugin(){
    let Metings = document.querySelectorAll('meting-js');
    if (Metings.length === 0) {return;};
    if (Metings[0].aplayer && Metings[0].aplayer.on) {
      // improve the accessibility https://web.dev/button-name/
      document.querySelectorAll(".aplayer-icon-menu").forEach(e=>{
        e.setAttribute("aria-label","Aplayer Menu")
      })
      // message see: /layout/_plugins/message/script.ejs
      
        try {
          setTimeout(() => {
            Metings.forEach((item, index) => {
              const aplayerItem = item.aplayer; if(!aplayerItem) return;
              const rightAplayerCheck = 'true' === 'true'
                && item.meta.id === '2185397204';
              if(rightAplayerCheck) RightMenuAplayer.checkAPlayer();
              if(aplayerItem.events.events.play.every(item => {return item.name !== 'messagePlay'})) {
                aplayerItem.on('play', function messagePlay() {
                  let index = aplayerItem.list.index;
                  let title = aplayerItem.list.audios[index].title;
                  let artist = aplayerItem.list.audios[index].artist;
                  setTimeout(() => {
                    VolantisApp.message('音乐通知', title + ' - ' + artist, {
                      icon: 'fa-solid fa-play',
                      transitionIn: 'flipInX',
                      transitionOut: 'flipOutX'
                    });
                  }, 100)
                });
              }
              if(aplayerItem.events.events.pause.every(item => {return item.name !== 'messagePause'})) {
                aplayerItem.on('pause', function messagePause() {
                  let index = aplayerItem.list.index;
                  let title = aplayerItem.list.audios[index].title;
                  let artist = aplayerItem.list.audios[index].artist;
                  setTimeout(() => {
                    // 歌曲播放结束也会触发 pause 事件，为了避免错误提示，等待一会儿
                    if(aplayerItem.paused) {
                      VolantisApp.message('音乐通知', title + ' - ' + artist, {
                        icon: 'fa-solid fa-pause',
                        transitionIn: 'flipInX',
                        transitionOut: 'flipOutX'
                      });
                    }
                  }, 100)
                });
              }
            });
          }, 500)
        } catch (error) { console.error(error); }
      
    }else{
      volantis.requestAnimationFrame(SetAPlayerPlugin)
    }
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    SetAPlayerPlugin();
  });
  volantis.pjax.push(SetAPlayerPlugin);
</script>




      <script>
  volantis.layoutHelper("comments",`<div id="giscus_container"></div>`)

  volantis.giscus = {};

  function check_giscus() {
    if (volantis.dark.mode === "dark") {
      volantis.giscus.Theme = '';
    } else {
      volantis.giscus.Theme = '';
    }

    return document.getElementById("giscus_container");
  }

  function pjax_giscus() {
    const HEAD = check_giscus();
    if (!HEAD) return;
    let cfg = Object.assign({"theme":"light_tritanopia","repo":"pistachio0812/blog_comments","repo-id":"R_kgDOIEvaCA","category":"Announcements","category-id":"DIC_kwDOIEvaCM4CRrCs","mapping":"title","strict":"0","reactions-enabled":"1","emit-metadata":"0","input-position":"top","lang":"zh-CN","loading":"lazy","crossorigin":"anonymous"},pdata.commentConfig)
    const script = document.createElement('script');
    script.setAttribute('src', 'https://giscus.app/client.js');
    Object.keys(cfg).forEach(k=>{
      if (k != "theme") {
        script.setAttribute('data-'+k, cfg[k]);
      }
    })
    script.setAttribute('data-theme', volantis.giscus.Theme);
    script.setAttribute('crossorigin', "anonymous");
    HEAD.appendChild(script);
  }

  function dark_giscus() {
    const HEAD = check_giscus();
    if (!HEAD) return;

    const message = {
      setConfig: {
        theme: volantis.giscus.Theme
      }
    };
    const giscusIframe = document.querySelector('iframe.giscus-frame');
    giscusIframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
  }
  pjax_giscus();
  volantis.pjax.push(pjax_giscus);
  volantis.dark.push(dark_giscus);
</script>

    





<!-- optional -->

  <script>
  const SearchServiceDataPathRoot = ("/" || "/").endsWith("/") ?
    "/" || "/" :
    "//" || "/";
  const SearchServiceDataPath = SearchServiceDataPathRoot + "content.json";

  function loadSearchScript() {
    // see: layout/_partial/scripts/_ctrl/cdnCtrl.ejs
    return volantis.js("/js/search/hexo.js");
  }

  function loadSearchService() {
    loadSearchScript();
    document.querySelectorAll(".input.u-search-input").forEach((e) => {
      e.removeEventListener("focus", loadSearchService, false);
    });

    document.querySelectorAll(".u-search-form").forEach((e) => {
      e.addEventListener("submit", (event) => {
        event.preventDefault();
      }, false);
    });
  }

  // 打开并搜索 字符串 s
  function OpenSearch(s) {
    if (typeof SearchService === 'undefined')
      loadSearchScript().then(() => {
        SearchService.setQueryText(s);
        SearchService.search();
      });
    else {
      SearchService.setQueryText(s);
      SearchService.search();
    }
  }

  // 访问含有 ?s=xxx  的链接时打开搜索 // 与搜索引擎 structured data 相关: /scripts/helpers/structured-data/lib/config.js
  if (window.location.search && /^\?s=/g.test(window.location.search)) {
    let queryText = decodeURI(window.location.search)
      .replace(/\ /g, "-")
      .replace(/^\?s=/g, "");
    OpenSearch(queryText);
  }

  // 搜索输入框获取焦点时加载搜索
  document.querySelectorAll(".input.u-search-input").forEach((e) => {
    e.addEventListener("focus", loadSearchService, false);
  });
</script>



  
<script src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/node-waves/dist/waves.min.js"></script>

<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function () {
  Waves.attach('.flat-btn', ['waves-button']);
  Waves.attach('.float-btn', ['waves-button', 'waves-float']);
  Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
  Waves.attach('.flat-box', ['waves-block']);
  Waves.attach('.float-box', ['waves-block', 'waves-float']);
  Waves.attach('.waves-image');
  Waves.init();
});
</script>



  
<script src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/comment_typing/comment_typing.js"></script>




  <script>

  volantis.css("https://unpkg.com/@highlightjs/cdn-assets@11.5.1/styles/default.min.css");


  volantis.js("https://unpkg.com/@highlightjs/cdn-assets@11.5.1/highlight.min.js").then(()=>{
    volantis.requestAnimationFrame(hljs.highlightAll)
  })
  volantis.pjax.push(()=>{
    document.querySelectorAll('pre code').forEach((block) => {
      hljs.highlightElement(block);
    });
  },"highlightjs")


  function pjax_highlightjs_copyCode(){
    if (!(document.querySelector(".highlight .code pre") ||
      document.querySelector(".article pre code"))) {
      return;
    }
    VolantisApp.utilCopyCode(".highlight .code pre, .article pre code")
  }
  volantis.requestAnimationFrame(pjax_highlightjs_copyCode)
  volantis.pjax.push(pjax_highlightjs_copyCode)

</script>








  <script src="//code.tidio.co/zilxs37hi5azxti3c2wescen575qkim6.js" async></script>





  <script>
  let imgs = ["https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/035.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/006.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/019.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/005.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/051.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/054.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/001.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/039.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/042.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/033.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/052.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/004.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/046.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/003.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/025.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/034.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/016.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/012.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/056.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/038.webp","https://unpkg.com/volantis-static@0.0.1654736714924/media/wallpaper/minimalist/2020/002.webp"];
  let index = 0;
  let IntervalParallax = null;

  function parallax(){
    let ParallaxWindow = document.querySelector("#parallax-window");
    
      ParallaxWindow = document.querySelector("html");
    
    Parallax.window = ParallaxWindow;
    Parallax.options.fade = 1500;
    Parallax.cache = 1;
    next_parallax();
    Parallax.init();
    if (imgs.length>1) {
      IntervalParallax = setInterval(function () {
        next_parallax();
      }, '10000');
    }
  }

  function next_parallax() {
    if (typeof Parallax == "undefined") {
      return
    }
    
    if (imgs.length>=1) {
      Parallax.options.src = imgs[index % imgs.length];
      Parallax.start();
      index++;
      if (Parallax.cache) {
        fetch(imgs[index % imgs.length] +"?t=" + new Date().getTime());
        if (index == imgs.length) {
          Parallax.cache = 0;
        }
      }
    }
  }
  var runningOnBrowser = typeof window !== "undefined";
  var isBot = runningOnBrowser && !("onscroll" in window) || typeof navigator !== "undefined" && /(gle|ing|ro|msn)bot|crawl|spider|yand|duckgo/i.test(navigator.userAgent);
  if (!isBot) {
    volantis.js('/js/plugins/parallax.js').then(()=>{
      parallax()
    })
    volantis.pjax.send(()=>{
      clearInterval(IntervalParallax)
    },"clearIntervalParallax");
    volantis.pjax.push(parallax);
  }
</script>




  <script>
  function load_swiper() {
    if (!document.querySelectorAll(".swiper-container")[0]) return;
    volantis.css("https://unpkg.com/volantis-static@0.0.1654736714924/libs/swiper/swiper-bundle.min.css");
    volantis.js("https://unpkg.com/volantis-static@0.0.1654736714924/libs/swiper/swiper-bundle.min.js").then(() => {
      pjax_swiper();
    });
  }

  load_swiper();

  function pjax_swiper() {
    volantis.swiper = new Swiper('.swiper-container', {
      slidesPerView: 'auto',
      spaceBetween: 8,
      centeredSlides: true,
      loop: true,
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
    });
  }

  volantis.pjax.push(() => {
    if (!document.querySelectorAll(".swiper-container")[0]) return;
    if (typeof volantis.swiper === "undefined") {
      load_swiper();
    } else {
      pjax_swiper();
    }
  });
</script>


<!-- pjax 标签必须存在于所有页面 否则 pjax error -->
<pjax>

</pjax>

<script>
  function listennSidebarTOC() {
    const navItems = document.querySelectorAll(".toc li");
    if (!navItems.length) return;
    let targets = []
    const sections = [...navItems].map((element) => {
      const link = element.querySelector(".toc-link");
      const target = document.getElementById(
        decodeURI(link.getAttribute("href")).replace("#", "")
      );
      targets.push(target)
      // 解除 a 标签 href 的 锚点定位, a 标签 href 的 锚点定位 会随机启用?? 产生错位???
      link.setAttribute("onclick","return false;")
      link.setAttribute("toc-action","toc-"+decodeURI(link.getAttribute("href")).replace("#", ""))
      link.setAttribute("href","/")
      // 配置 点击 触发新的锚点定位
      link.addEventListener("click", (event) => {
        event.preventDefault();
        // 这里的 addTop 是通过错位使得 toc 自动展开.
        volantis.scroll.to(target,{addTop: 5, observer:true})
        // Anchor id
        history.pushState(null, document.title, "#" + target.id);
      });
      return target;
    });

    function activateNavByIndex(target) {
      if (target.classList.contains("active-current")) return;

      document.querySelectorAll(".toc .active").forEach((element) => {
        element.classList.remove("active", "active-current");
      });
      target.classList.add("active", "active-current");
      let parent = target.parentNode;
      while (!parent.matches(".toc")) {
        if (parent.matches("li")) parent.classList.add("active");
        parent = parent.parentNode;
      }
    }

    // 方案一：
    volantis.activateNavIndex=0
    activateNavByIndex(navItems[volantis.activateNavIndex])
    volantis.scroll.push(()=>{
      if (targets[0].getBoundingClientRect().top >= 0) {
        volantis.activateNavIndex = 0
      }else if (targets[targets.length-1].getBoundingClientRect().top < 0) {
        volantis.activateNavIndex = targets.length-1
      } else {
        for (let index = 0; index < targets.length; index++) {
          const target0 = targets[index];
          const target1 = targets[(index+1)%targets.length];
          if (target0.getBoundingClientRect().top < 0&&target1.getBoundingClientRect().top >= 0) {
            volantis.activateNavIndex=index
            break;
          }
        }
      }
      activateNavByIndex(navItems[volantis.activateNavIndex])
    })

    // 方案二：
    // IntersectionObserver 不是完美精确到像素级别 也不是低延时性的
    // function findIndex(entries) {
    //   let index = 0;
    //   let entry = entries[index];
    //   if (entry.boundingClientRect.top > 0) {
    //     index = sections.indexOf(entry.target);
    //     return index === 0 ? 0 : index - 1;
    //   }
    //   for (; index < entries.length; index++) {
    //     if (entries[index].boundingClientRect.top <= 0) {
    //       entry = entries[index];
    //     } else {
    //       return sections.indexOf(entry.target);
    //     }
    //   }
    //   return sections.indexOf(entry.target);
    // }
    // function createIntersectionObserver(marginTop) {
    //   marginTop = Math.floor(marginTop + 10000);
    //   let intersectionObserver = new IntersectionObserver(
    //     (entries, observe) => {
    //       let scrollHeight = document.documentElement.scrollHeight;
    //       if (scrollHeight > marginTop) {
    //         observe.disconnect();
    //         createIntersectionObserver(scrollHeight);
    //         return;
    //       }
    //       let index = findIndex(entries);
    //       activateNavByIndex(navItems[index]);
    //     }, {
    //       rootMargin: marginTop + "px 0px -100% 0px",
    //       threshold: 0,
    //     }
    //   );
    //   sections.forEach((element) => {
    //     element && intersectionObserver.observe(element);
    //   });
    // }
    // createIntersectionObserver(document.documentElement.scrollHeight);
  }

  document.addEventListener("DOMContentLoaded", ()=>{
    volantis.requestAnimationFrame(listennSidebarTOC)
  });
  document.addEventListener("pjax:success", ()=>{
    volantis.requestAnimationFrame(listennSidebarTOC)
  });
</script>



<script>
  document.onreadystatechange = function () {
    if (document.readyState == 'complete') {
      // 页面加载完毕 样式加载失败，或是当前网速慢，或是开启了省流模式
      const { saveData, effectiveType } = navigator.connection || navigator.mozConnection || navigator.webkitConnection || {}
      if (getComputedStyle(document.querySelector("#safearea"), null)["display"] == "none" || saveData || /2g/.test(effectiveType)) {
        document.querySelectorAll(".reveal").forEach(function (e) {
          e.style["opacity"] = "1";
        });
        document.querySelector("#safearea").style["display"] = "block";
      }
    }
  }
</script>


  <script type="application/ld+json">[{"@context":"http://schema.org","@type":"Organization","name":"阿月浑子-Hexo博客","url":"http://pistachio0812.github.io/","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},{"@context":"http://schema.org","@type":"Person","name":"pistachio","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"http://pistachio0812.github.io/","sameAs":["https://github.com/volantis-x"],"description":"计算机视觉,文学,pytorch,hexo,江西理工大学,目标检测"},{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"http://pistachio0812.github.io/","name":"阿月浑子-Hexo博客"}},{"@type":"ListItem","position":2,"item":{"@id":"http://pistachio0812.github.io/categories/tensorflow/","name":"tensorflow"}},{"@type":"ListItem","position":3,"item":{"@id":"http://pistachio0812.github.io/zh-CN/学习笔记/","name":"tensorflow学习笔记"}}]},{"@context":"http://schema.org","@type":"WebSite","name":"阿月浑子-Hexo博客","url":"http://pistachio0812.github.io/","keywords":null,"description":"计算机视觉,文学,pytorch,hexo,江西理工大学,目标检测","author":{"@type":"Person","name":"pistachio","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"http://pistachio0812.github.io/","description":"计算机视觉,文学,pytorch,hexo,江西理工大学,目标检测"},"publisher":{"@type":"Organization","name":"阿月浑子-Hexo博客","url":"http://pistachio0812.github.io/","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},"potentialAction":{"@type":"SearchAction","name":"Site Search","target":{"@type":"EntryPoint","urlTemplate":"http://pistachio0812.github.io?s={search_term_string}"},"query-input":"required name=search_term_string"}},{"@context":"http://schema.org","@type":"BlogPosting","headline":"tensorflow学习笔记","description":"计算机视觉,文学,pytorch,hexo,江西理工大学,目标检测","inLanguage":["zh-CN","en","zh-TW","default"],"mainEntityOfPage":{"@type":"WebPage","@id":"http://pistachio0812.github.io/zh-CN/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"},"author":{"@type":"Person","name":"pistachio","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png"},"url":"http://pistachio0812.github.io/"},"publisher":{"@type":"Organization","name":"阿月浑子-Hexo博客","logo":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}},"url":"http://pistachio0812.github.io/zh-CN/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","wordCount":0,"datePublished":"2022-04-16T07:26:49.094Z","dateModified":"2022-10-04T13:51:36.177Z","articleSection":"tensorflow","keywords":"学习笔记","image":{"@type":"ImageObject","url":"https://unpkg.com/volantis-static@0.0.1654736714924/media/org.volantis/blog/favicon/android-chrome-192x192.png","width":192,"height":192}}]</script>



      
        <!--
  pjax重载区域接口：
  1.  <pjax></pjax> 标签 pjax 标签必须存在于所有页面 否则 pjax error
  2.  script[data-pjax]
  3.  .pjax-reload script
  4.  .pjax
-->



<script src="https://unpkg.com/volantis-static@0.0.1654736714924/libs/pjax/pjax.min.js"></script>


<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox]):not([onclick="return false;"]):not([onclick="return!1"]):not([target="_blank"]):not([target="view_window"]):not([href$=".xml"])',
        selectors: [
          "head title",
          "head meta[name=keywords]",
          "head meta[name=description]",
          
          "#l_main",
          "#pjax-header-nav-list",
          ".pjax",
          "pjax", // <pjax></pjax> 标签
          "script[data-pjax], .pjax-reload script" // script标签添加data-pjax 或 script标签外层添加.pjax-reload 的script代码段重载
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000,
        
      });
    });

    document.addEventListener('pjax:send', function (e) {
      //window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      // 使用 volantis.pjax.send 方法传入pjax:send回调函数 参见layout/_partial/scripts/global.ejs
      volantis.pjax.method.send.start();
    });

    document.addEventListener('pjax:complete', function () {
      // 使用 volantis.pjax.push 方法传入重载函数 参见layout/_partial/scripts/global.ejs
      volantis.pjax.method.complete.start();
    });

    document.addEventListener('pjax:error', function (e) {
      if(volantis.debug) {
        console.error(e);
        console.log('pjax error: \n' + JSON.stringify(e));
      }else{
        // 使用 volantis.pjax.error 方法传入pjax:error回调函数 参见layout/_partial/scripts/global.ejs
        volantis.pjax.method.error.start();
        window.location.href = e.triggerElement.href;
      }
    });
</script>

      
    </div>
    <!-- import body_end begin-->
        <script></script>
    <!-- import body_end end-->
    <!-- Custom Files bodyEnd begin-->
    <script> 
  volantis.rightmenu.jump = (type) => { 
    const selector = type === 'prev' ? 'article .prev-next a.prev' : 'article .prev-next a.next';
    const item = document.querySelector(selector); 
    if(!!item) { 
      if(typeof pjax !== 'undefined') { 
        pjax.loadUrl(item.href) 
      } else { 
        window.location.href = item.href; 
      } 
    } 
  } 
 
  volantis.rightmenu.handle(() => { 
    const prev = document.querySelector('#prev').parentElement, 
      next = document.querySelector('#next').parentElement, 
      articlePrev = document.querySelector('article .prev-next a.prev p.title'), 
      articleNext = document.querySelector('article .prev-next a.next p.title'); 
 
    prev.style.display = articlePrev ? 'block' : 'none'; 
    prev.title = articlePrev ? articlePrev.innerText : null; 
    next.style.display = articleNext ? 'block' : 'none'; 
    next.title = articleNext ? articleNext.innerText : null; 
  }, 'prevNext', false) 
</script> 
    <!-- Custom Files bodyEnd end-->
  <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>